const hardPuzzlesString = "600000270070420630004030000030002157090100000080000000208600003060800009100000005;020090760070006090005100000100300504600001000000408306000075603056000007000000002;082160700090300080050200160000405001809000602200006000000910003700080000000000020;004007005100600800090100030000002003408300600006008500000750000540000198200004000;479100500020500036000000000030062000700000400008010053060000084007400900142000000;030010000000020007009000800178000040060903080000800006200600003740002168000000902;000500080800009100000308000069050400407030065000000700502470010090000640006000020;002900100000000000000508020170000042080020000900005063600071305000003710003000094;901400300805000000000000000070320960200014008000609020000095840060000100009180000;000106700500070008000900420900700610408050973200000000010000090000027000340009000;023050090064900008000000000100260030040300006000000820001806000270001005008003700;000007904300952000296080050500000130040200000000000500060300070000800003730014000;500802760270600501000000200027000800000060000816400000600301000400000050080200900;000004001000576000080203605072005080000000090050800307004060100007402000500000020;012068000050000007600000900700000485000010200400900100800007300070009614030400000;200040000040903500300000070030005000000080004570400103609107300400600000800504000;403650090000090207000300000029000001004030960080000000100087059040019800000200000;009030070080900001504000080070500010190620000640000900053200007000000093000010500;290000000081090240000800060000015000860200000002400003000042900100080000026500870;800600750179800003000300004050090060000708430300010080460500000003040100000000000;006050000028400675000080000000100020805000000400060007090200700001706450300000890;070100008803060049000859000001000080000530010400070200000700006690080020000000903;050604000070010630010000004700000003091308000000040970000900460960007000400005020;000000030200030060809504070400812006006003420090000085050000040000020000000400750;050000084000601003090000700109006358400080000700000006300900100010003072080040000;080040000000000592000090040057002100003600480040903060902000000300570020000000870;057800000004030175000500000390047000010900027068050000100700000500000900000206700;120407089000000000804010000500300040000050000910000500300900006080001700650002108;080010000100005040705362000400200000000040806000030100008420000010600502020700030;050003910060000300000049002000000065006002403500031000089700000000090008005006201;000030219000700000000529300058002700300087000000000080049070008500001000020003506;012004000000000305060000040000000610300500000900420000040100020709340001000952470;801270009005000460900000107000390008160000000004000000002051093073000000000400806;000005003051002009800000000005200000908450006060100082036000008009006140700000030;360170900082000000000000000500082090008001307001060000900300406800910200003000080;860100000900000507000400000500930000000760010100000209040093001008015900010070050;389000000000030046010000000006103207900020000007654301000010000400200075002400000;500080000003700400000090000020409070100003025000506009300050080040600900700208300;009300100070000609000080070700050038420008000000000010208190700000007200300504001;910005000700002408800006090000070903008040052000200006090001000063020000080034000;084900100000602704002010000900301006010200370006040000603000008000080400200090000;637800140800000050090000000208056000000000803700010000502000060000720900100000274;090400701600007000700050400300010900008300000040080305200005007100090008073060000;000130260095000004000004000639720400002398010000000900300000700000009500070040001;007030681090570000000004000030400095120000806005000040601000370300000260000900000;008500037046002000300079000630050092000036010004000500489003000000000000000100049;403072005005000003762050004804000130000080000000000092950047000000000400000938000;400980500000070280090000003089000001000005400040100600270000900164530002000008000;000031058003500024200097000010000300905000007400020000301800600500700000060050002;751000000600004980000060000910302570200000060007506010400080200170050000000100000;000405006600019800500000010300060070000002045090000000000831624041000000000000981;000036000500000760206000009350700240900503000007000030034080002060001050000200003;000014050700600308400030000000205006800000010030401000106040000300950400054000003;700005400200090080000003005000019300100530002009000000000006047640007203070100900;000050200800030600032040000905600070000020950000093000000300802057100000340209000;200076050000000012041050008050027080900000000000008520800200307490080000000031000;009710500403060000000009000020300000054080000006000040000600205602407308000003160;050090060000010070000080400201000093000907500700003600000538206360070010000400000;030080005000000060600100000095000400000010503200900010700001000000840201310050784;060000084000050600000201000258000916300082500000006000000403200700100003480000090;700019800405000006020000000180000930269400080007000000601508024090000000000300100;400200001087030000000000058060300182031800600050000040300794000005081030000000000;900002001086000000000000970070850090300700500000010600409007300620005810800000050;000400600710209000080001029000000010073900008005060004300046702060008090000000006;082030070070045000100000006530006400600490000000803000400300600000200080090507100;280400000015060790000020430097000800800102000000000000509208006700090004130000000;005000060610097000908001500030002000700040600400010090000800021000050070027004005;000100406200005000000800903010490067003200008400680000501028000000000690000700010;500000009098030200001800400085006020700500000300090008049000800002005070000108040;075000030060005200000278005306080000800020001100709004000000000000010908004093500;800040065130000000000073000900300506360500070000000043650700120080100900007000000;890040000000070035000008970902800400050700300000006000000590100603280009570000000;413000009805006000000090005050001047600000000020560090087000200100208030040000070;003096000080000000000001049800302090301000250024750360100200000040000800008000100;700600001008000030010000700000009385009085600002030004600091200000004000904027000;000000200900000040002094710001503004004018300790000000030029180007000000020040003;000500000052300000009060048003000000004025071200009000805043700300207905070000000;760100003184500020000000056800000900300024800400050000010700602032000500040000000;600000800000021007090030004906804000004000015300050009010400920042000700000500003;060790000750000200000046000400000090010500080508000702900070020601900500800400100;000600504420900000300000018790042000001000600000000090970100835804500000000000049;000043000900680400700000080107000500008006003002009100020005800300268700000000069;036000000000403800009700000000000067050200080760010203870130090900000400000907500;680004209000013080000000000940600820500800370000020100200540000007000030160300000;200100000503098700009004030005600009000709800000005000000907046980050000174000000;001003406600080300000000020840300200002509000000100007006407050900060010010030060;800000070000710080007830000009050040000420007030000600400080320603000001001306400;302006040000000860400038000750903000000080405000100000100870056060000090007040002;000000400023040700004700010560020070000030500000005094470000003801090000090000182;007100000003002070004890350730006940009000200800000000000000014540910030000040090;000400000890001000564700000010600040753002010000073009400000030000000095039000702;400000190300801000000040700904050037018007000000000018006300001870000209200900000;345200000200041900000000000900470810000500000160000004690008000000060025570030080;406700002000032000200000000080000370673400000000000164010000730300276000009500020;500060900000018000010400867700104609000900080000000024000730500028090000900000100;900721085038000400000030000006800930200150060000000050103000026600390000000000500;060430002000806005000000010000200968591300070800000000300000400000950107050080600;100050200000810900000070000500600421060900050742000008000061030089500700004000000;001000402900000100063700500000014806080200050000000370340097605000300080070000000;030060090800500406000720000300600500792000060040000001500200630104090000003040000;605200000001000039309000000400628597200007000090000000030019080080070600002080000;000003902542000010090002085021049000000800003060001008000107004000020000000094050;000234800105000090000009000030521000800000600000700031980060000010040950000002078;600291000730000000000000000060000197400750000000000604940370015001000300250804000;015006700000098050090000000100200560930100007850600000070504000601003090000000003;000709300910004070600000040094805000060070039000000060200036000080400500000098010;900000200006500400070100090491700020000300010260000000802040060014003075000000800;089700501017040000000010002004108060300000009100509400402090030000050100900000000;180409700060080000059000100400720000800090050000038046208000400010005800000000090;004020105030050000020600090700000000000180940000400800006000030900003074010004289;007039600500020000010040030000480071300700006200006040090005300043100000000300080;740089500510207300000010000031700005000050690008400030403600000000000013000002000;672401800000300200009000004036000102508090070000670000050900460920000000060000000;000608007000070850000000630106840000540009000007023400000300002278005010000000500;000070020390000000000008500037000680060900000051046300805060002000100946600000100;900400803002500140780000000000073400010048600040600000360094007000000050000100060;009021300084000090130008000000309000002005070007680040096000008000006004700003009;060000009003000610904120000008013046000400000000080000000052000076040900035709800;100400000000102508700980030000000807400060000008020910064000750000000490210009000;928600000000918000130000900700036850605000090003002000300000208000000600504020000;102005300060097001030000000000040079600270010800000000010800602090000140200610000;300020000900301000000009500107000090000508460500600020002070030080930706050006000;030208500605070090002000000804060000200900100700800002190503026000000078020000000;000107030060000045070030000027865300000900007600040000703029000906000020100000600;081000007054010000070600100090700450200300000000100002120000608730050004000280000;028700000000003056000000710680051000071000800200030009400000380105078000000260000;600040000003000004041070208560007400800000030700021000020059000100000703350006000;387540000000800015000000308530100000000200160090004700060030800100602000203000000;030068000890200016607000000000080000900100087400002050004700200500900030760020000;502006070030005400090007000008460251060000000000090000003200017000010002240009080;040000586005000000000000201720510300560000040010070050380950700200608000000400000;000006070005908001980030600060000000510000806000000090006001023051000004032400100;080902300025000000730000600600000940000593800001700000900200085300140000002000070;900203010170000300300600000000030170604800050200105000050019000090000586000008000;849506120500900030700000065000064000384070000000008500070020000000800004060000002;600100000000000900030040000105607000470000003000094500098000070700400329050002601;049308000600010003370004050030100000004500060107000400000000501080700390000000820;017950060000103090004020030000800570920060000030010900009200301600500000000000002;000001800005000706020080094008560070100000300000210000060000958000805020800670000;460000805850130006000006740000201090500000000070340000020700010700050000930008000;018000063900800010000000000200080350000060100003400000036108702000972000009500040;500000100000078600730200000800509000000000529000000780076090000000807254000001907;000320700960000050008000036700065090340000000500004001000100203154000008030600000;062700180000480000000002000400010098070050023000003000000806900820300000305074000;170000000839010000004700019400003060700096000000270005000004600300960800090000400;030000700000910000720006910040000090006800002580120306002000005010045200000000080;000130549016080000400700000600300012500900000701000090020040000300000900070001036;000632590700000206030570100010098003320100050040000000904200000800000001000000400;700945000000000306000030007018000070500190040000306015060700100000080560400003000;690504000020700103507003000460000090050170000009000000201300070700000860000057000;009584000700000010200000000500016040400070900000000300800300509140769030060200000;600009000001070030000610020000200351902040860010000090500400900120300000300000600;013504620200000300000600080300460090000100035800000000170035806034000000050000000;009206000600800070000040200000504863024607000080100000800300507000450090000000400;307090600000004900000000005943200000050000073870003000700030082000510009090700400;000030900600000004000104070700602000000970300091000700000400107002090460480010090;000001900070200000010007040520730600900800100000500000603070000000305420700000365;010080000000030195000000200306000800200060530000470001090700048083502006000300000;200300000060001080000000090300070209500190608078240000490000010100609700000500000;800967003470000050000000007163000020007180000982400570206500000000000600000000800;000942060427000000000005010900610070030000804000400000800007205600004100000890700;400020908000000450700000000020045701690007080150300000006579010200000600000800000;050607010802090000000000008000000000600140379970000006780409600000210003004000800;000805200300001008602704000100052080060400500040000009806207000004008000000016000;050006100000420050700001090081003500000705900570204000400000072000050080308000000;000170208300005601000900000501000070740820000000010089628090040000000017000000800;003017200020000507009005000056800400040020900100009000090530020000004061700000009;031400500500800002000000690800029040006040100300050000200000050059106300048000000;100040537090160400002080000000607000000530000043000200007900100600070800359000000;070400300960203850000060000005721608801000000000000420000008019048090000000000080;015802000000100005000000040000750280500040000300200594006935000083020100700000000;705036098680000000000509004014300200000000750000000000500097040000640805003050000;040500708068000000700060030020700405309200600800000000206000100400030090000408050;006019080073000000010002500600370400107004000300000000285000010000501300900807000;000970010086010000300000400030000602108400000020503800702000530000805000050067000;070020050001003907900006000000000706800104009093070000400007201000659003000000080;800010000309000042007000580000005013010090000703000406000760005005040000680109000;013060050000050800005000000070420030590030007800000100000301000340690010900000503;021400000000060800008010000650080200000000017190627050805100000200000500006709000;000050300000083640309060000082700000030400900705000024170300000040006080000800070;000015200760000093090000800009602007002850000300009000108000529000700000900500010;000601730207000000106000000060000310900023800000400029400170205610300000000000100;000080071072030000460001020000000403090400000000570290040090052009005700020000030;000390004600000900300850100290003000006700030803009000005000370060001240030040000;000000039070530000200060000463000000700602500105000607000240010380000200902003000;070000010000070200400800500032050009610040750040000102800009020000000006060380090;358020004900040000000000300000100040700230069409560007530000000006000801040009000;020004008050000704000680001009040300030059800710000000642000090007001000000006470;002100090700000043105000000070085300040000700200060080300000562010490000007600010;541209000200008709000030000600500800000040013300000090139000400000820030080000100;580010000000820405300000718030500080000400100000082000050036090204000500703000000;007000890000000067500360001001000002050008000000100309064800010002701004070603000;120003070084097000079000046003620400756000000040000000000005920000709000900006000;046905000900020030000000001300160004000500870700000009094000603000350000000240507;008002540050916720070000000510000900032004000080070200390500000000060072100000000;230050800000090560000001000060000105053800096007500200040700030070200600500000070;207090056908000300006000008060800001001300000000600092000100700790284000500000080;400503090208070000000000000317400852000700640090000300040062000070000010000080460;902010600100460000060000000058070000040100080000086400200000706007040208006800009;010050700090000001820000040900604800008000014000230900746000029000007006100000003";

const easyPuzzlesString = "070000043040009610800634900094052000358460020000800530080070091902100005007040802;301086504046521070500000001400800002080347900009050038004090200008734090007208103;008317000004205109000040070327160904901450000045700800030001060872604000416070080;561092730020780090900005046600000427010070003073000819035900670700103080000000050;800134902041096080005070010008605000406310009023040860500709000010080040000401006;165293004000001632023060090009175000500900018002030049098000006000000950000429381;000003610000015007000008090086000700030800100500120309005060904060900530403701008;960405100020060504001703006100004000490130050002007601209006038070218905600079000;904520070001890240002643000070960380000108700600000010090080000000750030000312569;001408006093520741000010520602080300007060000005039060064052109020000654500607083;007300054245080900003040070070960000000020760000801002008294016609108020000007003;005346170000000050000800009502930741070000003000700020090050632207600400600420007;320090400705021800001060372218037009500480700000005000670000280000873900804000107;000030007480960501063570820009610203350097006000005094000000005804706910001040070;087002010204017003006800705508001000640008100002050670439180007020900030700023091;040000008760020349000470500900000030000036702308947000000004010200700603690001000;007009050040000930059740080000016790083000002710000000830060020000395018605020070;620740100070100052508000370067300900090000060800970031002000006000800000450002003;700000000400708061100296847000001400801000030090600075080010006007052394935467010;900000002010060390083900100804095007130670049060041000302010050000500000541080030;005000060000006302040081597012038754000200810087014000120007680000092030954860200;709000100421000050300700008100000302908320000002070809070530400090000675000600093;001300002079000000020670903000967300750001049080503100040702530205806700107405060;600017400401003008059800721120000050000040800008020100004530007700090086263170000;800005047040008500000000630000000490590040002072006305980000273067804051030070000;400000070060850240000301065049078500007032008280009430120703004700010000006200009;500000260024086000807152300000600703003400006700098120030800600072000481000070000;604001035003450001521900000069807104250014007410090006000060010000039070070140503;080000090090502000003001408007090630000000001650020000900300080310040970002879013;000000065004056701070813940006005490500690000009042000062504179000000030000000628;290800300000000046786500200020000100100009482647000903875200004310645700009008000;180023000942500008060010092209840000608395040300067850806000027407002900001700004;908260351500094872002010409003000084154083007020000905760100040009006000001005090;070620509029400000680570000300000000806750093000086005000000170064030000005004032;870500060010000207640180509000001000120006075008072006000605008000004000904008621;032104070500300002000625000080061020007402608201780054640000030098003700723056001;000001000003006097061037500000709800830040001000020006740008610300060052000900003;001002003004000900296015048560008197009000054700950300400187600010500402900020005;003060005792051400006200009268719054030026978000000601050103090029004000800002003;000009038000005004350700091000400000407500020060020805500900006840001070036040009;604300090210079064905014270450003900000001000008000000032700080890206010506000000;591300200004062031000917508063005080100480003057000000000090610048270395000050870;309000050007003060081407200108900020700340910932068000004080090506704000003020607;100000809950018000300000076580906000003500000204700560000000081600004003830169045;000000000084500970291000008809100500753942060010000000002714000370080400100035700;001090000009080054080576900076925301130000007495700080608250070000000006943607020;690538072080000600030907085040000900006029051000751800904000010008610090003000740;100500007090830004800200100400010072000048351001302006204900715315007690000000023;072834069045020008000075020014080000867040003200300800523408000000003080486007310;037604250200300100009250008000700090902005031740130006090070604001060000526800903;000000840090207100017568903700000600040602000003000002030850271900036500001700006;000000048300100720840000003003002006017060200620580304000013402100600890004857001;580062041060901000009000600006107839720008010001000006000705000075406003648039150;140000270070054319500207048000068024080400107024730000007000802802003400491806000;010000608900000100706300000500743000000005400340091075003200091104000300069000050;380500091697010005005080700460200003073098140800743000140000907730904000950070030;000050780000600010090020603100400000054260090007030001582910370000002500003000129;750314600830006001010000407507208000400000059000950084300000070081000003002001800;000070060200486010080032000400800030000047002600213740831054000527000000960020570;000534007000297500020016004000008000058409070000000600500000010900641850183700946;709000040032640059080279106000320000290001308013000020076100200000804003500002091;050600041003045600960800300600000100007008204402000003029500036006024510000000802;000090015000100840050380207000530000000602431012009500028003004037000002400050083;000000145903405700005000900092070000031502000600008500080009357700800600006007090;092405000007000250010800000746000309009060802100009067901030000600080900084590001;002085700000607000000100000400001007267504000001000090518700430030010506900003001;802604050000001064004005003900107430508390601317046020400063708080000000000000506;100305098090000000080179602624000000800607420370040800068004930030008060005006204;600083570300700900000069030000001008100630400503090010840302009032040085000058000;000006900000020874528000360035081000000073185070064209002040008019008403700002006;020030108500970020800002003740605300005087602060410800004090560009800204150260000;009630080081000023200580074000103809000408002000200460050900030070804290802010046;005400890000037254410809030200370569501900000790000008020004900640790103050010000;098100063060040000702500010400058030015000080306010000600005040927000300000206007;000002534000010280200034000020000740906000300140203000708000001300009600460070803;190406300523090700060300000000140257300560000040700600009000000401008902000007036;900002050002905004075340200097063405050000126080000973500607390000400502320001007;159080070240790001000000004300008000080070143092000005900100460507840300001007050;036704100007632000094500000000100034069807512000053000920000006050208001470300050;170504069009000005546091300680070020930100640700209500000006004000700096408002750;360000209800309005090012076000000002080090610603041800026580031100000000500020908;080026005000000623020940170050092081708400002090000040075634200260080030903007806;201006500000500800087300960000603704020009000400102398005060239093270081002001005;450029030139480050802300009504008090008500047070614008705000200200860900000070080;000008601400706850050003040005020004146580000003004905061805492020900076097600010;090060085180002369360900000050040008000009004074200050000736590700000000509000073;704930008008607000039000400070000600400500032000023709800200300206308175013700204;570203001903004085041000300700000190000098000219007030054806070002970010090020053;600000701010079603273801000800750002007018000021040008180025300030004060400307200;603000002709400300000000940210050890308027654060800701804001000500009438000300010;503004008008900605000570041130700006020600003406103000950017062001025030000896504;070940320200675009050008406843152000062407081000809004090200000000080060305000140;300007000009006710600004359702010098530409007001000000168000200900030580050000971;100780005030049120009300478850000000306904802000063040900420050400000000620038094;010000340920683050030714000052060001000001003000400079186592000049130006000046000;008603019305200000000007603501000000604000080890400052000750001000002004402006735;800100507070906001231405896008040760704012008000700015507601000910800004603000000;000000094041003000920060030030059006100200749298004300060300002002096150000042000;360400050401600070000057004030024019000009006010000023006008237290040601000000090;060004108081200050702000069050020900246107085973680000027050000300740002000800090;050843002800001000000965783000008924040106530090204018024007090086000270570600300;000003090010200700700000030090028047400190026120000589082000000900012654001006270;804005109090060074007100560400900800059080640010000032000000080030500016005070093;700908000600530000900100080204300000070060503030700020095402008480090152302815079;021374800740180002000026070230000500058000024900540008400008013096030005300450080;100700005470028060285003090002000034004060700300250016000000000020400371741900000;613040027000000000094000065200000030009607054000009600706300010000500006082164570;080500000016700005000000709109073408005829070078100030002005107000007080001068593;000080036002010050400509180020870600000090070076005010210708000045063729037000000;000854900030679100040010060000140600004068012102005008800000007000027000203000501;002608000008900420004100009703010060600020500820004100010050908250481370480793201;000000040431000800897004020062400300040293010500007092000001200000020074080570930;023901006941005732685023010000200078290000001104008000007580600450006003800300000;108036907000810304004509000200740680400000000000058002950180200007900801012004000;000105006160800900390700501001907805050380060080000003070008659000000400008509207;872000060100762080630900010040003520500004601310006007400207803001050000050040070;005890603060403000030050010500038100003009000190570000000042008850010409070905020;001070040700400038003000067004037020908024070307080050009008200006213090100056083;306700451000201006700000002290140005801000000435000109670000000043000900500003060;020090004641000037070000002500040021030780509006003000000000410000030096460200075;670000040300000000001065000807300090460000030009478201100000023706080054000910700;300006205052300000984000607840001579020058043000700060500403001270000000009502000;300000070002306010600890003000209560000570100500610934004000090006080701805001206;600730800025481006701000000490057001260000000510364098100540000030029407050876020;560000003008690000092045007040002080010409020270000496400000500089510002657008000;009001070143907208760824093030000001097410300620008000804065009306000000000080040;000063470600040891004080003720614059415030000096270004940000000060000745807001000;004001200790400100031905784003610005062307000000002000300050040020094061006030000;007000200310705406600040100000430527200607900000800010700004000190500860003080740;070586000000700530000140000809257100001000020560831074007000400000408359080029006;042639005300071600069208403034000000001000347000500100403015869596080000010062030;300905074090008001608004050764000019030009087000100430247590068000780000016000005;000000000300750960000800541030070100070490385045103600103245790000960013029001050;963710000000040903000000670502000030000050009007308154370200000209801300040030098;800000600326070000041090038408960572060701940970000186000400300002030860504010020;400051000573062900000000507800009153130600804000003000926800430054090208000024609;109805020640109750285040691800000000756010004000200000090081000007306800300402019;208035009050400603000179802090000000506814007704093060007001006000700080460000021;080000051004089030020406900108002000007810523000070080703021845050008002812300600;630502100400000736900070405290800004001000200500200003109005870000000000050029000;985000000400008610000025049100300462096500000040010007028450000000690070619802534;040017008892603107001098300100009850358024060009180000910000030087500019030040000;746000009308400070129600000000000002932000617004010090090080004607094203400200060;010307805305009740004080030047010003000003400100058206009031000038000900201806050;043927681010030920000408000724090006035000007900000030471000060050600019060070300;000701053040005010000800200530108000962504000000209340406000009103000520200000634;600930000000005306200008491100003904803600700924087560407500030302890605000070208;003005264609802000010000900096000730180600095000050000960030000005080019030209546;020000100050000080800435006600927400002000007907040021000298000290061040178000902;940260380037001900650800001360020000175000203028013000200005037710086592090002000;240069010000050000697431852020100086500940007000006520300014065010093270050000001;005000920800000500072050004006004285000060001009018306090001058008593000650802000;210403709040006030007918000401830076003160890026097040300000900579040200084000050;000302000600000508405000030079006004002800607850017000900703480000140900200069300;001320050620000430008004062103090070780461293042080000030070000007240300000130040;060090504100065208070082690002057040500230080097806325080020900600009000003670002;537008000600709800040350006376100020008520300254603090000010000105070680460830700;008060230020000009647209105405020608102000074060700000006002800000070901030408720;000978200300050498200043715680300000003800600020007309100709056800005137700100040;286000013010000506300060800030704065000000000000510900001080407040256000009401032;500032810000087000870450902900245000050090473408100209000060328082010095000008004;800106300030008200001000084000307040010002809762804005000080713380901400176000908;000000040659084120000910000073620900800000356000835207260048000030090468904000500;702004598000800071001790004004006050000000869098003007040058702000030000010200930;126000735000100000700003104010730409943000672005906000302000001001800007007010246;000058000063000289200030107007600400840012090000000700602001904930000072000000015;908200070200001695761000800097100500000000010000000402600415080304002150002730040;805700409000690058409020760003080270600079003000102006570940630390200004000058910;079005006000020040263070105000000002090000638835000004000702800081450203307600059;000170068000000000001003009020835010050010243003020900302069004500201076087304002;094801730007450629500907408005000004140000200003105890020304061386000000001090300;405381002017500830802070001100000078780940000003000050071806009900027005528409000;978543612526071003000200009600019005190650204000000000357094000000000030004700090;051600700069703852800905400580000027000250300320000600900000000600408230700506080;000000678410060002063000000001005200000810050070240010187409000900001005304672009;000071980790385100150029637000930000079500804000807009060104050000700013017000400;080020306071006000300000000804050000000004205052100647509800700603000000048302090;960308520750000000803260700074100000020036000305482170519040260080000000000520008;503704920070000060000060800020098070608400003000623590001049030006001709009870104;024786000006502407708000009875960102003004005000107000000630950530070026080210730;000000080019000002025780341970358000180097003050006009340070005061005428000004600;470139680008250400009040000900074001030000900000091006005760040604023100000000208;200019500000083970900740810072064090049025600018007040000930460000001000094000050;600000305075903001120050900851004290009380000007002400706040009002100060930060050;920006400010980007007020009052170003100002705700453020070001800300069502509047306;000230600859001000362504800080020946000046000046180000608402105520600070000853402;450908276000005000000076084010050600000097030009600058035009801108320000064000300;030000060600034059000020408700406210000201080009070006007100604180040075905000000;000010258001007030042030107593472600008000003106080040039000002010500000705060390;090054037050000601103209580001002070000510000084070160715600009000301006320090418;768400300190032007250068009010600000940025180600901705021050070070103000009270000;020900003605000902000060504200010040004300010096470025907026401000093857000700096;100070983050006074302900000500637490040501302030004010790002845200489000480700000;082050900570040100006010000820194300000730008060005010758300090000409002090500007;503621007009050102008009046095170064000802000217000900000000610730000400450006000;900470836020080009008900000482000960070109208006200075051300090207000503600010782;700000009598370021601090700004005300070429000080000060007200005420700010000961270;804036751600200308000008060050729000003054000009300475912000000500090107307085924;700250000548900010026047000200600403380075020460012070870030594054000001030000267;570140900001056307000080405009405180010809000600000209060000801000698700084007690";

let puzzles = hardPuzzlesString.split(";");
let puzzle = null;

let undoStack = [];
let redoStack = [];

const noSleep = new NoSleep();

let wakeLockEnabled = false;
const toggleEl = $("#toggle");
toggleEl[0].addEventListener('click', function() {
    if (!wakeLockEnabled) {
        noSleep.enable(); // keep the screen on!
        wakeLockEnabled = true;
        toggleEl.removeClass("unselected");
    } else {
        noSleep.disable(); // let the screen turn off.
        wakeLockEnabled = false;
        toggleEl.addClass("unselected");
    }
}, false);

loadLastState();

function level(easy) {
    if (easy) {
        $("#easy").removeClass("unselected");
        $("#hard").addClass("unselected");
        puzzles = easyPuzzlesString.split(";");
    } else {
        $("#hard").removeClass("unselected");
        $("#easy").addClass("unselected");
        puzzles = hardPuzzlesString.split(";");
    }

    newGame();
}

function mode(v) {
    $('#numberbuttons').hide();
    $('#markbuttons').hide();
    $('#centerbuttons').hide();
    $('#colorbuttons').hide();
    
    $('#numbers').addClass("unselected");
    $('#mark').addClass("unselected");
    $('#center').addClass("unselected");
    $('#color').addClass("unselected");

    switch (v) {
        case 1:
            $('#numberbuttons').show();
            $('#numbers').removeClass("unselected");
            break;
        case 2:
            $('#markbuttons').show();
            $('#mark').removeClass("unselected");
            break;
        case 3:
            $('#centerbuttons').show();
            $('#center').removeClass("unselected");
            break;
        case 4:
            $('#colorbuttons').show();
            $('#color').removeClass("unselected");
    }
}

function newGame() {
    let randomPuzzleIndex = Math.floor(Math.random() * (puzzles.length + 1));
    puzzle = puzzles[randomPuzzleIndex];
    resetGame();
}

function resetGame() {
    let counter = 0;
    $("#board").empty();
    for (let r=1; r < 10; r++) {
        const row = document.createElement("div");
        $(row).attr("class", "row R" + r);
        for (let c=1; c < 10; c++) {
            const cell = document.createElement("div");
            $(cell).attr("id", "C" + r + c).attr("class", "cell C" + c);
            const div = document.createElement("div");
            $(div).addClass("number");
            $(cell).append(div);
            if (puzzle[counter] != "0") {
                $(div).append(puzzle[counter]);
                $(cell).addClass("fix");
            }
            $(cell).append("<div class='m'></div");
            $(cell).append("<div class='c'></div");
            $(cell).append("<div class='border'></div");
            $(row).append(cell);
            counter++;
        }
        $("#board").append(row);
    }
    initCellClickHandlers();
    undoStack = [];
    redoStack = [];
}

function initCellClickHandlers() {
    for (let r=1; r < 10; r++) {
        for (let c=1; c < 10; c++) {
            const cell = $("#C" + r + "" + c);
            $(cell).click(function(e) {
                cellClicked(e, r, c);
            });
            $(cell).dblclick(function(e) {
                cellDblClicked(e, r, c);
            });
        }
    }
}

function check() {
    $(".error").removeClass("error");

    let counter = 0;

    //rows
    for (let r = 1; r < 10; r++) {
        const numbers = [];
        for (let c = 1; c < 10; c++) {
            if (!checkCell(numbers, r, c)) {
                return;
            }
            if (!cellIsNull(r,c)) {
                counter++;    
            };
        }
    }

    //columns
    for (let c = 1; c < 10; c++) {
        const numbers = [];
        for (let r = 1; r < 10; r++) {
            if (!checkCell(numbers, r, c)) {
                return;
            }          
        }
    }

    //sections
    for (let sr = 0; sr < 3; sr++) {
        for (let sc = 0; sc < 3; sc++) {
            const numbers = [];
            for (let r = sr * 3 + 1; r < sr * 3 + 4; r++) {
                for (let c = sc * 3 + 1; c < sc * 3 + 4; c++) {
                    if (!checkCell(numbers, r, c)) {
                        return;
                    }
                }
            }
        }
    }

    if (counter == 81) {
        showInfo("Sudoku gelöst!");
        return;
    }

    showInfo("Keine Fehler gefunden")
}

function cellIsNull(r, c) {
    const cell = $("#C" + r + "" + c);
    const value = $(cell).find(".number").html();
    return value.length < 1;
}

function checkCell(numbers, r, c) {
    const cell = $("#C" + r + "" + c);
    const value = $(cell).find(".number").html();
    if (value.length > 0) {
        if (numbers.indexOf(value) >= 0) {
            $("#board").find('.R' + r).find(".C" + c).removeClass("selected").addClass("error");
            showInfo("Doppelte Zahl " + value + " an Stelle " + r + " / " + c);
            return false;
        }
        numbers.push(value);
    }
    return true;
}

function addUndoEntry() {
    undoStack.push(getState());    
    $("#undobutton").removeClass("disabled");
}

function addRedoEntry() {
    redoStack.push(getState());
    $("#redobutton").removeClass("disabled");
}

function getState() {
    return $("#board").html();
}

function setState(s) {
    $("#board").html(s);
    initCellClickHandlers();
}

function setLastState() {
    localStorage.setItem('lastState', getState());
}

function loadLastState() {
    const state = localStorage.getItem('lastState');
    if (state == null) {
        newGame();
    } else {
        setState(state);
    }
}

function undo() {
    if (undoStack.length > 0) {
        addRedoEntry();
        setState(undoStack.pop());
    }
    if (undoStack.length == 0) {
        $("#undobutton").addClass("disabled");
    }
}

function redo() {
    if (redoStack.length > 0) {
        addUndoEntry();
        setState(redoStack.pop());
    }
    if (redoStack.length == 0) {
        $("#redobutton").addClass("disabled");
    }
}

function buttonClicked(number) {
    if (!$('#highlight').hasClass('unselected')) {
        highlight(number);
        return;
    }

    if ($(".cell.selected").not(".fix").length == 0) {
        return;
    }
    
    addUndoEntry();

    $(".cell.selected").not(".fix").each(function(){
        $(this).find(".number").html(number == 0 ? "" : number);
        $(this).find(".m").html("");
        $(this).find(".c").html("");
    });

    setLastState();
}

function markButtonClicked(number) {  
    if (!$('#highlight').hasClass('unselected')) {
        highlight(number);
        return;
    }

    if (number == 0) {
        $(".markbutton.selected").removeClass("selected");
        $(".cell.selected").not(".fix").find(".m").html("");
        return;
    } else {
        $("#markbutton" + number).toggleClass("selected");
    }

    if ($(".cell.selected").length == 0) {
        return;
    }

    addUndoEntry();

    $(".cell.selected").not(".fix").each(function(){
        let marks = $(this).find(".m").html();
        if (marks.indexOf(number.toString()) == -1) {
            marks += number.toString();
        } else {
            marks = marks.replaceAll(number.toString(), "");
        }

        //sort alphabetically
        if (marks.length > 0) {
            marks = marks.split('').sort().join('');
        }

        $(this).find(".m").html(marks);
    });

    setLastState();
}

function centerButtonClicked(number) {   
    if (!$('#highlight').hasClass('unselected')) {
        highlight(number);
        return;
    }

    if (number == 0) {
        $(".centerbutton.selected").removeClass("selected");
        $(".cell.selected").not(".fix").find(".c").html("");
        return;
    } else {
        $("#centerbutton" + number).toggleClass("selected");
    }

    if ($(".cell.selected").length == 0) {
        return;
    }

    addUndoEntry();

    $(".cell.selected").not(".fix").each(function(){
        let marks = $(this).find(".c").html();
        if (marks.indexOf(number.toString()) == -1) {
            marks += number.toString();
        } else {
            marks = marks.replaceAll(number.toString(), "");
        }

        //sort alphabetically
        if (marks.length > 0) {
            marks = marks.split('').sort().join('');
        }

        $(this).find(".c").html(marks);
    });

    setLastState();
}

function colorButtonClicked(cssClass) {
    if ($(".cell.selected").length == 0) {
        return;
    }

    addUndoEntry();

    $(".cell.selected").removeClass("red green blue yellow grey");
    $(".cell.selected").addClass(cssClass);

    $('.colorbutton').removeClass("selected");
    $('.colorbutton.' + cssClass).addClass("selected");

    setLastState();
}

function cellClicked(e, r, c) {
    const cell = $("#C" + r + "" + c);
    const multiple = e.ctrlKey || !$("#multiple").hasClass("unselected");

    if ($(cell).hasClass("selected")) {
        $(cell).removeClass("selected");

        if (!multiple) {
            $(".cell.selected").removeClass("selected");
        }  

        return;
    }

    if (!multiple) {
        $(".cell.selected").removeClass("selected");
    }    

    if (!$(cell).hasClass("fix")) {
        $(cell).addClass("selected");
        initMarks(cell);
    }  
}

function cellDblClicked(e, r, c) {
    const cell = $("#C" + r + "" + c);
    if ($(cell).find(".number").html().length == 1) {
        const n = $(cell).find(".number").html();
        highlight(n);
    }
}

function initMarks(cell) {  
    $(".markbutton").removeClass("selected");
    $(".centerbutton").removeClass("selected");
    $(".colorbutton").removeClass("selected");

    if (cell == null) return;

    const marks = $(cell).find(".m").html();
    for (let i = 1; i < 10; i++) {
        if (marks.indexOf(i.toString()) > -1) {
            $("#markbutton" + i).addClass("selected");
        }
    }

    const center = $(cell).find(".c").html();
    for (let i = 1; i < 10; i++) {
        if (center.indexOf(i.toString()) > -1) {
            $("#centerbutton" + i).addClass("selected");
        }
    }

    if ($(cell).hasClass("red")) {
        $(".colorbutton.red").addClass("selected");
    }
    if ($(cell).hasClass("green")) {
        $(".colorbutton.green").addClass("selected");
    }
    if ($(cell).hasClass("blue")) {
        $(".colorbutton.blue").addClass("selected");
    }
    if ($(cell).hasClass("yellow")) {
        $(".colorbutton.yellow").addClass("selected");
    }
    if ($(cell).hasClass("grey")) {
        $(".colorbutton.grey").addClass("selected");
    }
}

function highlight(number) {
    $('.highlighted').removeClass("highlighted");

    $('.cell').each(function(){
        if ($(this).find(".number").text().indexOf(number.toString()) > -1) {
            $(this).addClass("highlighted");
        }
    });
}

function showInfo(text) {
    $('#infotext').text(text);
    $('#infomessage').show();
}

function numberKeyClicked(number) {
    if (!$('#numbers').hasClass("unselected")) {
        buttonClicked(number);
    }
    if (!$('#center').hasClass("unselected")) {
        centerButtonClicked(number);
    }
    if (!$('#mark').hasClass("unselected")) {
        markButtonClicked(number);
    }
}

function move(direction)
{
    if ($(".cell.selected").length != 1) {
        return;
    }

    const cell =  $(".cell.selected").first();

    const r = $(cell).closest(".row").index();
    const c = $(cell).index();

    let newCell = null;

    if (direction == 1) { //up
        if (r > 0) {
            newCell = $('.R' + r).find(".C" + (c + 1))            
        }
    }

    if (direction == 2) { //down
        if (r < 8) {
            newCell = $('.R' + (r + 2)).find(".C" + (c + 1));
        }
    }

    if (direction == 3) { //left
        if (c > 0) {
            newCell = $('.R' + (r + 1)).find(".C" + (c));
        }
    }

    if (direction == 4) { //right
        if (c < 8) {
            newCell = $('.R' + (r + 1)).find(".C" + (c + 2));
        }
    }

    if (newCell != null) {
        $(cell).removeClass("selected");
        newCell.addClass("selected");
    }

    initMarks(newCell);
}

$(document).keyup(function(event) {
    switch (event.keyCode) {
        case 87:
            redo();
            break;
        case 82:
            undo();
            break;
        case 37:
            move(3);
            break;
        case 38:
            move(1);
            break;
        case 39:
            move(4);
            break;
        case 40:
            move(2);
            break;
        case 48:
            numberKeyClicked(0);
            break;
        case 49:
            numberKeyClicked(1);
            break;
        case 50:
            numberKeyClicked(2);
            break;
        case 51:
            numberKeyClicked(3);
            break;
        case 52:
            numberKeyClicked(4);
            break;
        case 53:
            numberKeyClicked(5);
            break;
        case 54:
            numberKeyClicked(6);
            break;
        case 55:
            numberKeyClicked(7);
            break;
        case 56:
            numberKeyClicked(8);
            break;
        case 57:
            numberKeyClicked(9);
            break;
        case 90:
            mode(1);
            break;
        case 65:
            mode(2);
            break;
        case 70:
            mode(4);
            break;
        case 73:
            mode(3);
            break;
        case 109:
            $('#multiple').toggleClass('unselected');
            break;
        case 98:
            $('#toggle').click();
            break;
        case 99:
            check();
            break;
        case 13: //ENTER
            if ($('#infomessage').is(":visible")) {
                $('#infomessage').hide(); 
            }
            break;
        default:
            //alert('Handler for .keyup() called. - ' + event.keyCode);
    }
});