const hardPuzzlesString = "090302000000000009000000000103000790006000300080200056300620900600970000902830000;700000208003050600500000000000000000006090000000502040400700000601024703087605020;007000000003000000050280007000300090300090025070804000630000902780010000040000051;000502000003000000008100000010006000000000000800015000030050900600074032087023450;000000002120007580009050004003000000460089000090003010530000900740000000000030000;000000000000100600000009100100400006006090070000010005315024900000901032080006014;000000400000000070000000100000000090008000310000301200010605984000010020046920001;000000000106040509080006004010060000000019000090003400001080907000900040900034000;000030090035000470600000120002006000007001000896070000000000000000905802008004000;008000000000000009000000100010365000000080000000004365001502908000000001985001400;306025000100000009000007000010406007000000060090003000030090600000030001900080720;000004300100059000070000000000005009006000000000020400000007980840906012007102503;000805000000009070600000130003050089006000210807300060302580000000000800900000300;205000000000257600009048000000465798000000003790000006000000060000000500903072040;300000000100000000000100000000060007405890002000213450031000000042000008000574010;500040000000007000009000020000070090456080073098000400300090000807506000900032700;000005067040000000070000305100050000000000003000010050030561080500004630060032070;710000000034100000509200030020405890050000000000000500041000950000000300072000000;000008000005060008000040100000050080050800000096020050500004800000905012068172004;930502000000168300000000000000050000006000003000000000300000000000031780890624031;090300005020000089000000000200500600000100200870064301000840076040005800980000000;007800000020000709068000020000000800050100040009200001600000000840710003000683010;000030000000006700000009000200000000006090200807014600030000978000000160902670403;000080010020400000008070000004005000300000062086004053030000008800090301972000040;070080061000050000400170005200000000000200040000004002000020900000901003082743510;000000000100000309000300000000050000400000003000000460371000982045082701080030046;000060001020308070009000308200456000000000000700000005000000080000000512940580706;037000000040000000000000005002006780000091006000002150521004003860000507900005840;000000002120060009050238000004000000000091000095004003530900000002685900000000000;070300850000400079500000100004500000050000000000020360630940000000600010080700026;002005000300008000600207030000006000400009002097300006208000054561804000970000000;007000000000007000568000100210000090006700200000000005300000006670001800095670300;000080200030107000009006005000000700007000326090703050000070042000900510070500000;000000050000040000009107200000060097406700000000000000000003040007594312943020076;009000100000400009508060030010006008300790000007200056000000060060000823900003000;800000000100000680009008004000005000006091000000003010000000900060080301081534002;000000000200007600000400000020040000407000030000070000300602057700035801905004360;065001090000000508000000100000060000450000002000100000000004071001007025978510603;000000000000009000000007000100006009006000000007312006010605000648071320000803000;050042060200109500000008000000005600060090000090000000010000790000900040907003800;000000003003400009009100040005000700040091025096270300000000007000003060900054000;000005160000000789000020000013408690000209003000000004000004020860900000000000006;000070030000200000000006000003057069000008100800000350300504790604000500008063012;000500170000207500009040006203000708400000360000000000020000000000000600900023801;001800000006000400709000026000050000065700030007010000000000800000002904970081002;000000970140070300009305000000000700400090060600000010520600800000000502004582000;000000043100007080000000007000405000006708001709020050000004000000000312900002804;000000200024056000600000035200000090060009000005003060030000000870002014040580000;000003020100060000400080030000050008070090000000020005000801072782900000901000050;009000000000100000060000000123000090050890000000260400301085000670900008900000364;000570000004000000567000130010400897000000000008100456301000000600914080902000000;000000600000567000460000000010035000300008200000000350500020907040001530902003061;000030020100050000000000006000000090000000050570020300000000908700013642942078510;000000000000000080509008000014005800000019200890700300031600900700900432000000000;000001000100000008000060000000500000000098206000723400040875962002004007000600040;008000000000000000400008256000005800350890000896724000630000070005000604040600500;700000004000050080000000000000060800000000140007000063030642008600081000008073600;000000500030000000000400020013000000000309210098600045020860001600000800081700006;000000001005000000089007230203400000006000000090300065020004078000000900008021046;001003000230060000070200000000000090046090210089000500310000004867000001050631000;000000000004000670000000000003400890050000000000020015302007960000902030947600002;000000000120400009009007200005000000000000000008065000001500906860003450952004013;050000000026300000000050000013000800000000000000020406531694000000532040902007300;008007300000000070000200158000000090400089200000610000000000000700000903900700564;300000001005000000600000000000000000000801236896000104530602007060030000980010560;300000608000000079008050120010000000400007000080000000001000002802030014007621385;309002000000008000000000003000500700450007030000000000001004000700081340904235600;008107005000050000000000026000000007005000008000004250530860004790000831001073500;000000500000000009500007340203465090000700000000000000000092008802600900005070200;000070000000000700000230150200005000000000012080000000001642008600003000890500603;000090000030000009070100006003056790000010000008020100001600900080000604900500003;000000060000108500780300100020000008000000000000000000001080950860970041900500600;000300800340000000000000000020400600000001070000000000200008900534960718908004023;050040810100000050709000000210056000000890003800312000000000000000901000070520601;040010070000000000509000100010000000300801200600004300001000890002003050000047600;000900400000000000009107000210060007000000000000200504601070908000091300070804051;000000030003000670000000000000000000057000200698070050730000000005943012040781060;400003620000000000000000004100400000500089210000710040005000700074520900060800051;000000000100009000700000005000050600060300007097012054500000090078903500943001800;000003001100000670500070000010000069300000400000004000030002807840007000000006540;007090030000000000000000004014500007356080001790214000000600000000000700070000460;200080500000000000000400103010000700000000006090020400020030001861905042940602007;090000000000000700000000005000030096056090007089000350001000970000910003042760000;008030041003000700070000050004000000000800000000200000600000000000081605905670412;050000000000000508009000100014375689060000000000004010000740000040030000970000400;000083900120009070089027000000300009050090020000000000000070000800932000900040263;000001000000000080089237140010065800006000010090100000000000000000070001072608530;000000000020000700600209040200060890000008014800024036500002000000000000000003401;000009002003000000000008057204500000000090040090200000000602900000903061940015023;000000802204000009080000000020060000060000000000310050302600580070840921000520307;000000004230006000060000120020548097400001030008000400000020076675000000002000000;006080210000007080080020000013400000000600020600003000500000902000005001064710000;400002000023008000000000000200060000300000010709010060005721980000903500900080730;000901007100000000070000000000070800000100000000623400000504768004716002900030040;000000327000000080000200040103000090506091000007000400312000900004900000070000003;040000008100000600000300020000500097350709001000100000001005080805000003960040015;007095000000060000009100206204050700000700400096820100000000000000003051970600320;000500000023060000000030000214050007000007000009024600501040900000005000908000002;000500000000370400009008200000000700000000120007010000000004800062081004904705610;009000604020050000060000100004000090000090200000200007030701008080905073947060002;000003001120008000400100300004050000075092000000000005530000900000001500087200604;001000000050038000080006000020000007040600090600070000000700000805000014900015730;001905000045100000709006100000000008050000000000612300500004000070093020000500076;000000800000000000000000000000540790400080030897312004020604985008001000004030602;007000000000000070609007100002000000406000200090000400000980060064700091070510802;004002000100060000009058020200000090000080030000003000500090802007000965900000010;006800000000050080078060030010000000360090400000020050001000900607000502002516700;010020000000000009000000000100040000500700200008001045351000000804395012000010050;400020090103050000000307000004006000000008000700000000032900000000200907971605002;000005000000000080000100207210000000060700000809204030500940000000080023000073050;002080900000000000709000025003408009400000000097000001001070096000002000908600040;000002060000107089000000005003006798000000200000000500000805000000904001054671030;000610000120080000000000000210546080006000000000100400040000008068970342000804610;000000003023000609670000045004000000000007000000024000000002067507010400000040031;308001070000300089007000020003500008400000001700103500601000050040000000000604810;000970003100000700000008020010060000006009200000000000520000000067000304040810562;000100005104000089000200000210000800000001320089003051605000040070040000900508060;000040502004000000009000030000005080000000003008312000002000960040001005000726341;080007000000250080000040100300000007400009000600000005700590630800000950005001274;000000001100008679000000234010000000000091000709000100000000080842007560005030000;018090000000060500079000006000056090400009062000003000000680007000004021002070640;200300000104006700009048030302060090000890002000720000000600000000010000000080020;908000000103008009000000000000350007000890000080004100000042901000900650000010700;006730000020450080007009000000000000005000000790200005530000970070928003800003000;095000000000260000070309100010000000000000000080600005520000000040006002960580340;040007000103400000080000045000060800000089100000000003400070000802690051060000032;000000000000000000089000005004000080000090402700824000031000807840500031070180004;000087000004000600700000000120005000050800200000000500002070940006012350075604001;000000008103000000000050000004060000357801006600000000031007000005000700972040680;000000090035000008000057020010040080000000230790130000000004000004000362000305000;000089007100200000700106040000050000450600020000302000020003070000910060000000003;009000200020000700000100000000030690060001028890060130001800000706900000942600070;007090000000050700000007030000000090400000060096800000600502040800030620940081500;070900020000050000000200004010000800300780000007100000600040070040891053900037012;000003100120407000006180230200300000360090002000014000000070000080000003900500821;495000001120450009070100005000000600056090000009200003000000000060000500040010000;200870000000009000000000020002007680407000200008000005000004067004900302060702854;000000000100000000000000000000000807005798100009004500031042970640901205802073000;030207040000100000709050103000040080000081000097000000000070000060900207070600000;000000000000009008000350000003060080056000003807000000200004000000070000974532860;000000000004000000600050003003500000450009230000002000010070905805921340000030810;000002051020450089000000030200000800000008040000010000001005000000000403042060018;008000004100009000579300000010050000000000000000003000000000937085932040043017802;002507000000068009000009020000000000000001000000723405020680000005902081900075040;500000003030050000600209100000000000000000300060300000310000007045910800986703010;040300001023000078000006300000000000050001080890000050400005000000940010908600504;030200000000000500000409000200000008000007030080120400001682970567010002890000010;000000500000000000007009000000507690006090030008000000300005900602904001080010374;000500008030000000000049030020000000000000300789003006310700084004900020097000560;000000000000000000709000100002460098007109200090720400021004007870001002000800350;009000600200000709000000100023000097006700010800300005300000000000031006060587000;000060000040008000078050000002080000000001238097003000020000970064000080000007642;000800903230159000580000100020075000400000201000000000000082000000936000900040080;000609020000000009500108007010000708000000006000075000001080005050960010006513070;235000071000079000000000000000000000050000000000700000500603890000020514000581603;905000000100000570678300000010000000000000060069200310030000000592740001006000240;080000045000000000000000000003000000000007000790023050520600397037012064004370802;000043000004500070060000034000000708050000300800002400000600980070081000085034000;004000015000300080009100204200060000000098100807003050001000900002000070008630500;000002003000056080000000206000060090065000000807000000500000000700021534002080070;000792000000000709070000005010000007356870020700014060000000070800000050000507030;010200000200007000000008020100000006406000000800623010340000902005000300000004060;000590000000000600080040105023009700000000203000002500010800000004000007900605340;000000100000000080000000000200300700056700010090210000402800001001002850980631027;008700000100050000009008305004000809300001000000006500001002056762530900000000034;060008000100000008080000100005600000040000200807010000030500000000940053050700640;030000000000006000080000000010400800006008103008310050001600908064020000003000010;000002000000006000060400000003540000000000000709060005001625900602004001895000000;001087040000000008000045006100000000000090001090010004302004000860070403974000610;000000200123050700000230100205000000006000000000000314001005926500910830080000000;000000000000047000000000004000470000000090273000600010000780002507010348890004701;050000000000400500070008204010300600000700000000024300501007006740006050980002041;001000005000100000000009000020000096000800000000613054000000060670901043002506001;010820000030106009509000100000000007050090200708000504040680005800001000000500010;500000010120078000460000250004306000300000000000204000000005070070001005005720081;000001306003400700000000100004037000300600200000004000000800900041900002982700460;709000010100000500008020307014007090050090402000000000005060081080000750000004023;485600002000059000600000100010060000300000000800004001530006020700100000000072010;076000050000006000089000040000000090407089000608700400001000000862000000905678001;600720050020000089508000006000400007450000300807000460340000000000000500082034001;010000092206040070080230000000000009007008000008702000000001900005920010001004820;000030600000060009000020300010300000009001004080000000430000056005903800892010000;000018000003400670080206000010000080300007000007100006001602000008070023000503060;500000002000056009680207000000000000050090000708312000002070008860000300071000600;000009043300008600000000000000000000007090230896200451230005004064010007000004000;040000000005000070608040000003400007400090000069003000304607000080010040002000600;007000400230000009000247005003400000000000010700000004000000008000600901001874002;009500000100000009000009000010007006000090000700000300001725984000004653940680001;040002000000460009009000040000006000006000402000204305030000980801003004000800620;000000000003008070507000000000000096000000007080600000005712000070043062942586701;430000001020000060709000205000000009540001372607023000050000000000000016004008003;000090000000000000000000000300050090050089103008002065600034007800000610900621000;060000903004200000509000000010005009006800000000000005623580090041000580000000340;300098410004000700609040030010400097060700000000000000000000000876900001000001603;000000008000400000000060120000500807000001040800070003400700005765910080080045701;000000000000007000000000200000000700000000010069700004400070965780953401900604800;010003000004000000000050003003000000000098001000000400040970800062300017007015300;604000000230108000789000005000007090450000000800600004300000907001000000008000541;006039040030060009500000000120050708400000200600000400000005000000003054005004321;000030400023400000050009020000000890000897014000104000000000000000008000907503642;008003600004000080070000235010000000000809020090000400001600008000080000086520340;";
const easyPuzzlesString = "002080000000000089060079030203060800050891306600020040321640050040910603000030410;600000905040030008000050000100060709406790210807300056010680597068001000904500800;000000400000000000000108367014306098075009006000710200531692870640800950080503021;060000000134000600500167034010000800006308000807000450325941786040080500000506040;000001205104008600507040130003005897450000300789100456040780000602004003001000700;079001000120500400000070005204030000006897204807104300000080041742016003081003760;005000017000000009000009234012070096400090070789000145500740900860002051940006728;000003000100000600068009037213465000456000000070300006021800965600030002087500304;002061090004259008689040005200075800405000200090000010021700900540032081908006002;040030025103050009008020306010065007000090200080040010031602008002000630800900470;000980040000000700780030000123405090405708002890012060310009670546070920970600000;070345001000008070000000004002050000400801300096703045601500980705980603903010400;001000000030008500000200130100000700450890003809310060010005907640000350905723040;016300207030060009500240006103000090407800060600720015045682000700001054900004023;060041000023568070450009020004635090070000000000017053001704060640003081980056040;002004000100209608009078100000400060006000000000600401001546890605917340047802500;812500000000067089009240105020006090050000026000002514200005071090703802000904653;000900000123057089000000140000375890006089020708000513001000060842596001000013054;000021000020069008000400103200005700000007014097100000400280950072003841005714600;070500090230009000080000000120006000546000310790230560310905070000302901950010003;000040800105000070089150000012400098450800000090320000521674983800000540904503000;090070050100250000000309100012060000450700036780020400001500948843690070970042000;000000000000060080000000134210400096056009000790623410301090768502730000960000003;080539000100000509000120307214050708000700260706080100030000970005010000901672050;009000000003467580678200004204070608306000000807024010430010900705932001900006020;000370090023450678570000030014530089050800000000000350730600902040910560000004813;350704210104350000078109040000400890060007000000000060030602900702030051906001432;800000000123070060067009000004007896076890000598104302600080041041000085000400003;908600200030000060000000000023000798400090012089312456301807005675000000892503070;070020000020408079000009205200060708300800002009004006501000460092741083000030900;000008050000056789500200034210360097050800006000004000002017968000000001001642070;004010830000000560000000000215000700300890015080002346030586902057021083092040050;000500000000308069070169230003050708457890000009230100031605900840012000900080001;260000000030200000009100260002000700006009302708312406621800005843905000900000804;040761003005200008000000124200000060000892017790106240300904756000017000060023480;010305908000000260000206035123007000056801370007023001000068094070002010960704000;934010526020300089070009034000000000050007010789023460000670950562904070000001040;030000000004680007080300024210000789400098013700023000041570890000900001070014000;260000094005000007080000100003000009000000028090362400512000903638005040074023506;792580036030007509060340020003006798400090000000100005300005900005932800080004352;000000600005300009600200035003056097400807010007120506031700000064005382980030050;900047005120006700000000006213060090407208603089013000300072000700084501805031070;041029000206008009780300020000000090007800263008207010000574006000013050075682341;900640007205000069670000000020000090000897203780013000002984605500030080090500430;010000090200009000700000100003406009400008061608712305501000000074920003902573000;200040000130008570009307100000005006056802300700600240021004060043906051900501000;000000000120056000670100005004300800356090014000014000031600908562908070000540632;240508300000200689700130200002000008400000020698000104500710800064023070970860030;040000100000400089678030000200305097000890402080200503000600008060081070800003621;600009000200050600780006035120065008000000002000703016312008964840010500075604801;000300000030250609679140030010400890400090007007023000000700900040080010000512743;000000938040080007089235006003406780000800002007002000510073000034008501970501020;030000000020350009000100000010005807006008103008010060041520078800031904905070012;000030010000060000000100004210005600000000000700000305305746891867001453041083762;400700000000100009008209034103400096040091000709020015310000900800902040050634700;700000600000406700009078000000060897000089000090714000500047028640001573980520416;030000008000000069780200135200000006507609012690120047350760900004500003000830651;000009000030170060789406003120040806056002000807600245002760000564980030000030001;000814620000000509078209030200400890400098003009603015041006000560000000807540000;008000300020057609000009000004000098000798000780200030500841960601905003090603001;000000800020000000400030050010000098000709124000241305030092600602875013970003540;000000600234007509009030040000006708400700003890312056302075960005023070070001300;000030400120009000400078120000000000070890200098020354500086002002040561906502037;009000010000000009070100030010400090040000000806273000351684902060905843084732060;060000000104200608000030045000405089056000023097312450000073000073904512000021307;000000006000060070089307000020450709450790010098000000000602947800030651064571800;000060020000058670070100400004005006000800240000006015401087962002934080005600734;000205007105008060009100000003000690406809372007000000030002946000934501000561003;000001400000050080579068003200506098406780001007123506030014005041030800980000004;040510000005007089000049100000400000007001063000020014320680900584000600090135802;002195000105000009000006000203050096450819007800620014000000083630901700008532600;010030650204100009000000123000507006050091000800000010001025008672980000080714060;000500004100000089568040137010056700450000260096023400000680970672900000000002306;000701056125300470000009000003040000506800231007000000000004000000913045964285317;030600070000000350009340006100006897400080013098000200312060904065020000070001562;075300460020000789068000005010030090006090247009004000031802906040900003090063514;000000324020400089409030050014305097006000040090104560531600900002070005000580400;000100000130206000500400003003547000056000207089062000321680005690710040800925301;000100008006280007000350124213405080007800000000003000000040090805902000934018570;000000000024359000679128300203005800005800030800200000531607092700900580906040000;090508100100009008500000000010000000300090210709210006630042085002030041945680732;500000600004068570009407003013006890008001006090080000341600080862900051070812300;006700000200000000000360004020000000407800000098203450040580016701040385905631042;000008040000107500008009000120406790450091003600073015040000970062004850005012634;080003950000060478509070100015000709006000000000000000400602097072980030950731042;005000000103507080089103007004006708056098010098004000037001942000030070902400831;860031290023400000009200006000306700305002001090100000030080900700013002001725643;002001050000206009080357020003000800000780010890020400361072900020908001070000532;002000000130000080009100000213405000065009020000002456301000968540908301070030040;000000000045009308009007024103075080450090000708600200030004060802900050970000831;000870310000046000000005000000000698400390027000610453020001974004003061060704500;007000690004000008000050024300400060005091000098003005501708040843010752976002000;030000026000008500678000000010000090050000017789013240000086050500930781800520403;000000000000000000600035048213406097006009100798010406301874960800003701960021300;040000200020058009009000000004300090350100420890024001030500082560002013972010560;000100420124300009508000130010000790457092060800003005000000904005034600902600800;800000002103009000600050034210005000000891247000004000031507026007930001902046053;800703000103006000000009200000065890375800062000047315531000040006900020080530071;057080004000309608600100035003460700000000100008013006030020067000006001006831542;007000900100000408600050000000506700456700200098120060530280690002001300970035000;491000000030100000670009000000046807540000001789010546000780065804900000907601380;000090107103400080080000000200030768005081000000204013000802900600900000978615430;400000032200009500009030100103000080500008060090010054312560097065070000000820605;030000540000000000089100236013060000050200160090013405300500678070600900005070312;000070600020006700609000205000000000000000507700062100031605978000910460960084351;000000004000400000400139267210000790000891400000070130031700900090043001005912673;700900000000156089009078003003000000000009310007000045301605070670812000900734001;905000300000007000000030005120060708007891036800072000340506072590700004780024513;780000000030009670000078200203005069000790302007000100320046057605000800070530410;014580003000106080670230140103050000400790028009000001300820006502900004800014500;300080000200030700000009105000057690406091027800002451530028004782000063060570800;400900012100040000000100006000008697500209130608700204000000871800071023970832460;000000900023409008600100305210065080056090004090000500000806000867900050940531867;830000060000306009509408000213000690000000230098620000001780906672000040980060370;009000006003007009078000120010536098056790240800000005401200067000004053905003012;405060020000450600000003007200070006300280010708610035001702000840500070960831040;006900201100040009089106005003000000000200000000703050000690027064070913902031064;005790000003050009000000040010000000306079120700214560500640908047903600901080030;000001800020000509600000024215030000006080015090000000401576002000042630960803457;600030010120000700000000000210360090005009020890210500001600908702800650906041002;000008000030000000000309120120006090000801060000273405340680072702030850095710604;005000000030206080070000000000405097406879213008120500501034070000017000967000001;300000060100300570080000030210460798005090013007100400001682907640000000078504020;500020003100409608780000000004065089007208406000700050430082907060970534000000001;600000070200078069700056004020060897006700010890012050300000900062090043970504001;006000205100567080007000000004005098300002504070410062601820050080953641005070020;000072810100300000709156200200005008057009060690700400031620087800090001904000506;000034608305000000000120005020450097006007200700210006001700984560980002800340001;092000067000000009070450020013540090450700031000302640021000900060021070907630800;064905010000248009080006000000057006000380100890012400020703980040091000073020000;800640900000009000009370024020465000456000000090003406001520800605001342082704060;001000002004150600089067104020000069400308000000610305040581000070003401900700020;001000500200100089600000100003000007000010026900703015300074958584930001096000200;087003900000000478450108006000006089305897000090010560001620807000905040040701002;907008000020000000000279030004500000376000452089024300030042500000105960090063241;000000006000500200069000104000000089456000312790010005001004907640030820080720643;700800400000150000009300020023000869450000317890013204000500080500086701060030542;004000000000009070070100000003000009056890210798203056000500967560931000002704531;095040008100000460000109050000057806356001704000064000000480900647003001902705043;387000000000000000560004078203000000400000103098013056600702000870030604905601732;030060001040008600009100200300000090058091300096380150521074980063905007900010000;000690420124050000000200000000005000060000210897023500001000964740036850906014370;036070150000200000000100000000005800457809320000020405524001780871043002900700000;008500010120300000560000000210000090406091300080030140301020084042000051895004003;900500120000068000008000000203400800050800003609237400000705982702980000090612034;060009041023000089000130006004300097057801400098004135500042070000000004942000600;006004000100000078009150000302000000450300026698702045021603007060007510970001400;000000096105000007000240035300400780400090002700000560520000978860972451000005023;046075000020460009070009006010006090300001260689700010430680000005900400800047631;600080030000209008500030009003000807050008023000312640301675980000900006967001050;000000000000000089508120047210406700406008003709210460031580000045900600070030001;000309007000078050080045230010400708007000300090000000521607984800010003900004621;000318690030209000080050003002000000000090230000003014501934060063170000970002351;037090000020000780009000035213065800000080203098103000001072968060900500000018000;700020000100568000408300026004035000000001000896247000531000000002003085987450600;401000670000100000670408020000000090000801000890370514300680900754000800000025341;200890000106000780700156004300005000060089023000002000001640000008901040903578612;000030900003000508509007300004306789006790014790004000000000097040973002902601453;002600940300000570000000100020400709000000300698013250201004897005901430074000610;035001008000000000700006000000007000040000030008100070351064800864932715972015300;000000360000000080078309120014536708000798241009020605500042900000070413900610000;090260007103400600060009200000300090006798010009510340000070965050024870070035400;000000008100208070078109000010000090050890003780020104300047080840010562060080037;070093050034000080500000230000400800006009000008310500301070900045901670900020318;070843000103000070000000006000306709300090004008214563531080047042070030060430021;000000005025040009000000000000060000007801306869200051001582967506004080780910503;000020500004007080570060003123500700407800036080070410001080057000035001005004062;000000050100000000000080000210600000000798214780024063001076040642910875070450031;200039401100000509009008000310000090000001000098302105021603900843015007060724003;306090000100000000000000308000056007407000006000000025701640982802971653005800710;000680000120370000080045200010006009007098361600003504000060902072031640900027003;615029030004108079080340025103000000450000210007010000000502900060004381078630002;001030000200009008000047105100000700050790310800302000310600900560970820078503041;000100890005080000009000025203407080056000000897003510021764900008002740074518200;000500000000000069060109307000356798006097000007204605000005000005042003082001456;000000000003400609078169000210006098300000150080010040430500907602970400897004500;607005000024360009500000000010050000000700023000203645001072056000530000905648201;900520000245000000078030200003450000056800302089013050310000900500080703090040560;000090000000000000000030200210065090006870132000300465300600958045023600060581324;800000000120050000000378020000004800300000010790000040401287956600943001000516032;459007268103008079078009030000000007307091005005020306000040000700083902900000603;000000200005048600600050100020405090000890300700012005307024006562980040004000501;080000006000000000609000130003450000450789000708002564562801907810070000930004851;000693400200000000000240005000060000006009010890302046040576000078901060962834751;901080205034100009000240000000400800450097310700300504010004958607008000845021003;000240005104300009089060004003075008056000027000020051301002790072900040005704180;000020000204050600060040000020000700057890200800200504300000906600934801985700042;060073001000400000500008046204056000050007100090214035600040807742605903900030060;000800002103007009008230000010350090065000004000120356007682901601970820092501000;050000000023400080000030045004005800000000014097024500531040008740980053980570401;042000800006200400080006100010507009007008201090020574000000965000900300965312700;065003000020057000408209100014005006050890047080620301031000900040000000800500014;000000070004000509078040006010400798407090062680003400025600040746900851000000600;900104260004007080070000004210005008406091372089000005040708956060900800001000703;800000034100000700007309020004037090070000240000024007002960470700245063906800012;001005607005060380000009005000450000050700000789012056007084900060901030890623070;900708000000056709078000046005307098300000020700260134000082901002000873091600000;000001900120380007080000100210000709400000001800132040341875002000000000008264310;000900070000000000009400100010006090400089201798023600300290007060834010902600350;817000000200079500060200137120456789056097000708000050000000805005900001980000070;407200000103000000068130007004300000000801472789604000630000010800010500900086703;";

let puzzles = hardPuzzlesString.split(";");
let puzzle = null;

let undoStack = [];
let redoStack = [];

const noSleep = new NoSleep();

let wakeLockEnabled = false;
const toggleEl = $("#toggle");
toggleEl[0].addEventListener('click', function() {
    if (!wakeLockEnabled) {
        noSleep.enable(); // keep the screen on!
        wakeLockEnabled = true;
        toggleEl.removeClass("unselected");
    } else {
        noSleep.disable(); // let the screen turn off.
        wakeLockEnabled = false;
        toggleEl.addClass("unselected");
    }
}, false);

function level(easy) {
    if (easy) {
        $("#easy").removeClass("unselected");
        $("#hard").addClass("unselected");
        puzzles = easyPuzzlesString.split(";");
    } else {
        $("#hard").removeClass("unselected");
        $("#easy").addClass("unselected");
        puzzles = hardPuzzlesString.split(";");
    }

    newGame();
}

function mode(v) {
    switch (v) {
        case 1:
            $('#numberbuttons').show();
            $('#markbuttons').hide();
            $('#centerbuttons').hide();
            $('#colorbuttons').hide();
            $('#numbers').removeClass("unselected");
            $('#mark').addClass("unselected");
            $('#center').addClass("unselected");
            $('#color').addClass("unselected");
            break;
        case 2:
            $('#numberbuttons').hide();
            $('#markbuttons').show();
            $('#centerbuttons').hide();
            $('#colorbuttons').hide();
            $('#numbers').addClass("unselected");
            $('#mark').removeClass("unselected");
            $('#center').addClass("unselected");
            $('#color').addClass("unselected");
            break;
        case 3:
            $('#numberbuttons').hide();
            $('#markbuttons').hide();
            $('#centerbuttons').show();
            $('#colorbuttons').hide();
            $('#numbers').addClass("unselected");
            $('#mark').addClass("unselected");
            $('#center').removeClass("unselected");
            $('#color').addClass("unselected");
            break;
        case 4:
            $('#colorbuttons').show();
            $('#numberbuttons').hide();
            $('#markbuttons').hide();
            $('#centerbuttons').hide();
            $('#numbers').addClass("unselected");
            $('#mark').addClass("unselected");
            $('#center').addClass("unselected");
            $('#color').removeClass("unselected");
    }
}

function newGame() {
    let randomPuzzleIndex = Math.floor(Math.random() * (puzzles.length + 1));
    puzzle = puzzles[randomPuzzleIndex];
    resetGame();
}

function resetGame() {
    let counter = 0;
    $("#board").empty();
    for (let r=1; r < 10; r++) {
        const row = document.createElement("div");
        $(row).attr("class", "row R" + r);
        for (let c=1; c < 10; c++) {
            const cell = document.createElement("div");
            $(cell).attr("id", "C" + r + c);
            $(cell).attr("class", "cell C" + c);
            const div = document.createElement("div");
            $(div).addClass("number");
            $(cell).append(div);
            if (puzzle[counter] != "0") {
                $(div).append(puzzle[counter]);
                $(cell).addClass("fix");
            }
            const divM = document.createElement("div");
            $(divM).addClass("m");
            $(cell).append(divM);
            const divC = document.createElement("div");
            $(divC).addClass("c");
            $(cell).append(divC);
            const divB = document.createElement("div");
            $(divB).addClass("border");
            $(cell).append(divB);
            counter++;
            $(row).append(cell);
        }
        $("#board").append(row);
    }
    initCellClickHandlers();
    undoStack = [];
    redoStack = [];
}

function initCellClickHandlers() {
    for (let r=1; r < 10; r++) {
        for (let c=1; c < 10; c++) {
            const cell = $("#board").find('.R' + r).find(".C" + c);
            $(cell).click(function(e) {
                cellClicked(e, r, c);
            });
        }
    }
}

function check() {
    $(".error").removeClass("error");

    let counter = 0;

    //rows
    for (let r = 1; r < 10; r++) {
        const numbers = [];
        for (let c = 1; c < 10; c++) {
            if (!checkCell(numbers, r, c)) {
                return;
            }
            if (!cellIsNull(r,c)) {
                counter++;    
            };
        }
    }

    //columns
    for (let c = 1; c < 10; c++) {
        const numbers = [];
        for (let r = 1; r < 10; r++) {
            if (!checkCell(numbers, r, c)) {
                return;
            }          
        }
    }

    //sections
    for (let sr = 0; sr < 3; sr++) {
        for (let sc = 0; sc < 3; sc++) {
            const numbers = [];
            for (let r = sr * 3 + 1; r < sr * 3 + 4; r++) {
                for (let c = sc * 3 + 1; c < sc * 3 + 4; c++) {
                    if (!checkCell(numbers, r, c)) {
                        return;
                    }
                }
            }
        }
    }

    if (counter == 81) {
        showInfo("Sudoku gelöst!");
        return;
    }

    showInfo("Keine Fehler gefunden")
}

function cellIsNull(r, c) {
    const cell = $("#board").find('.R' + r).find(".C" + c);
    const value = $(cell).find(".number").html();
    return value.length < 1;
}

function checkCell(numbers, r, c) {
    const cell = $("#board").find('.R' + r).find(".C" + c);
    const value = $(cell).find(".number").html();
    if (value.length > 0) {
        if (numbers.indexOf(value) >= 0) {
            $("#board").find('.R' + r).find(".C" + c).removeClass("selected").addClass("error");
            showInfo("Doppelte Zahl " + value + " an Stelle " + r + " / " + c);
            return false;
        }
        numbers.push(value);
    }
    return true;
}

function addUndoEntry(fromRedo) {
    undoStack.push(getState());
    $("#undobutton").removeClass("disabled");
    if (!fromRedo) {

    }
}

function addRedoEntry() {
    redoStack.push(getState());
    $("#redobutton").removeClass("disabled");
}

function getState() {
    return $("#board").html();
}

function setState(s) {
    $("#board").html(s);
    initCellClickHandlers();
}

function undo() {
    if (undoStack.length > 0) {
        addRedoEntry();
        setState(undoStack.pop());
    }
    if (undoStack.length == 0) {
        $("#undobutton").addClass("disabled");
    }
}

function redo() {
    if (redoStack.length > 0) {
        addUndoEntry(true);
        setState(redoStack.pop());
    }
    if (redoStack.length == 0) {
        $("#redobutton").addClass("disabled");
    }
}

function buttonClicked(number) {
    if (!$('#highlight').hasClass('unselected')) {
        highlight(number);
        return;
    }

    if ($(".cell.selected").not(".fix").length == 0) {
        return;
    }
    
    addUndoEntry(false);

    $(".cell.selected").not(".fix").each(function(){
        $(this).find(".number").html(number == 0 ? "" : number);
        $(this).find(".m").html("");
        $(this).find(".c").html("");
    });
}

function markButtonClicked(number) {  
    if (!$('#highlight').hasClass('unselected')) {
        highlight(number);
        return;
    }

    if (number == 0) {
        $(".markbutton.selected").removeClass("selected");
    } else {
        $("#markbutton" + number).toggleClass("selected");
    }

    if ($(".cell.selected").length == 0) {
        return;
    }

    addUndoEntry(false);

    let marks = "";

    for (let i = 1; i < 10; i++) {
        if ($("#markbutton" + i).hasClass("selected")) {
            marks += i;
        }
    }

    $(".cell.selected").not(".fix").find(".m").html(marks);
}

function centerButtonClicked(number) {   
    if (!$('#highlight').hasClass('unselected')) {
        highlight(number);
        return;
    }

    if (number == 0) {
        $(".centerbutton.selected").removeClass("selected");
    } else {
        $("#centerbutton" + number).toggleClass("selected");
    }

    if ($(".cell.selected").length == 0) {
        return;
    }

    addUndoEntry(false);

    let marks = "";

    for (let i = 1; i < 10; i++) {
        if ($("#centerbutton" + i).hasClass("selected")) {
            marks += i;
        }
    }

    $(".cell.selected").not(".fix").find(".c").html("<span>" + marks + "</span>");
}

function colorButtonClicked(cssClass) {
    if ($(".cell.selected").length == 0) {
        return;
    }

    addUndoEntry(false);
    $(".cell.selected").removeClass("red green blue");
    $(".cell.selected").addClass(cssClass);
}

function cellClicked(e, r, c) {
    const cell = $('.R' + r).find(".C" + c);
    const multiple = e.ctrlKey || !$("#multiple").hasClass("unselected");

    if ($(cell).hasClass("selected")) {
        $(cell).removeClass("selected");

        if (!multiple) {
            $(".cell.selected").removeClass("selected");
        }  

        return;
    }

    if (!multiple) {
        $(".cell.selected").removeClass("selected");
    }    

    if (!$(cell).hasClass("fix")) {
        $(cell).addClass("selected");
        const marks = $(cell).find(".m").html();
        $(".markbutton").removeClass("selected");
        for (let i = 1; i < 10; i++) {
            if (marks.indexOf(i.toString()) > -1) {
                $("#markbutton" + i).addClass("selected");
            }
        }

        const center = $(cell).find(".c").html();
        $(".centerbutton").removeClass("selected");
        for (let i = 1; i < 10; i++) {
            if (center.indexOf(i.toString()) > -1) {
                $("#centerbutton" + i).addClass("selected");
            }
        }
    }    
}

function highlight(number) {
    $('.highlighted').removeClass("highlighted");

    $('.cell').each(function(){
        if ($(this).find(".number").text().indexOf(number.toString()) > -1) {
            $(this).addClass("highlighted");
        }
    });
}

function showInfo(text) {
    $('#infotext').text(text);
    $('#infomessage').show();
}

newGame();

function numberKeyClicked(number) {
    if ($('#center').hasClass("unselected") && $('#mark').hasClass("unselected") && $('#color').hasClass("unselected")) {
        buttonClicked(number);
    }
    if ($('#numbers').hasClass("unselected") && $('#mark').hasClass("unselected") && $('#color').hasClass("unselected")) {
        centerButtonClicked(number);
    }
    if ($('#numbers').hasClass("unselected") && $('#center').hasClass("unselected") && $('#color').hasClass("unselected")) {
        markButtonClicked(number);
    }
}

function move(direction)
{
    if ($(".cell.selected").length != 1) {
        return;
    }

    const cell =  $(".cell.selected").first();

    const r = $(cell).closest(".row").index();
    const c = $(cell).index();

    if (direction == 1) { //up
        if (r > 0) {
            $(cell).removeClass("selected");
            $('.R' + r).find(".C" + (c + 1)).addClass("selected");
        }
    }

    if (direction == 2) { //down
        if (r < 8) {
            $(cell).removeClass("selected");
            $('.R' + (r + 2)).find(".C" + (c + 1)).addClass("selected");
        }
    }

    if (direction == 3) { //left
        if (c > 0) {
            $(cell).removeClass("selected");
            $('.R' + (r + 1)).find(".C" + (c)).addClass("selected");
        }
    }

    if (direction == 4) { //right
        if (c < 8) {
            $(cell).removeClass("selected");
            $('.R' + (r + 1)).find(".C" + (c + 2)).addClass("selected");
        }
    }
}

$(document).keyup(function(event) {
    switch (event.keyCode) {
        case 87:
            redo();
            break;
        case 82:
            undo();
            break;
        case 37:
            move(3);
            break;
        case 38:
            move(1);
            break;
        case 39:
            move(4);
            break;
        case 40:
            move(2);
            break;
        case 48:
            numberKeyClicked(0);
            break;
        case 49:
            numberKeyClicked(1);
            break;
        case 50:
            numberKeyClicked(2);
            break;
        case 51:
            numberKeyClicked(3);
            break;
        case 52:
            numberKeyClicked(4);
            break;
        case 53:
            numberKeyClicked(5);
            break;
        case 54:
            numberKeyClicked(6);
            break;
        case 55:
            numberKeyClicked(7);
            break;
        case 56:
            numberKeyClicked(8);
            break;
        case 57:
            numberKeyClicked(9);
            break;
        case 90:
            mode(1);
            break;
        case 65:
            mode(2);
            break;
        case 70:
            mode(4);
            break;
        case 73:
            mode(3);
            break;
        case 109:
            $('#multiple').toggleClass('unselected');
            break;
        case 98:
            $('#toggle').click();
            break;
        case 99:
            check();
            break;
        case 13: //ENTER
            if ($('#infomessage').is(":visible")) {
                $('#infomessage').hide(); 
            }
            break;
        default:
            //alert('Handler for .keyup() called. - ' + event.keyCode);
    }
});