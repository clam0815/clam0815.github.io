const hardPuzzlesString = "470610050032597046050040000080120734740809125021000689090081000000000000000000000;960085070372946000051327000007030000000000000006000000010068000798503624640792000;970028000861490030000007980008060000007804000010900008050000894009280600786549000;730080060840000009120030857963070248512948000400020501050012080000000000000000005;983070405004536982256498713000780000005600870008900004000000000040060050001000000;000090308430060975000030000012000036003000000000300004080000453304000289295843167;050009000020057008000000000700004009060972050294538671506040792409000000302095000;002170040000060000000408000006200410700000620020016300000002781108700263273081904;460003009798502000312000050207360500036150700501000000070000005050900000029005413;070000400000000000395147682000000056050000000000050900000579000007431569549628317;961000070857000009243000060416000090579010086320697050734000908080000000090000000;805021097001300286002908105349000851517890062206510000970000000000000000000000000;400000008280406000070008000008000000000700826607800045004265080851947632062080000;000000000000074090007000450091000000700000102000100039369000875815709324472538900;200709058098000004056400903007900001821543769000617082000000800000800090080090000;005000381007050642060400000639004800500060034470000160701040006006090403304000008;000601003000389000639702000105428030000917000000536000902075306000293050000064000;905400000200105000700280050800950000501600708000800500058700043030548007420316000;004700080000034200000000400070020000080007000905400700040090571859271643317546000;004802970000004612092607005000003100241000398000001000000009000020005009479068251;450020610610045020928106000200000106000000300301602000000700030709203060132560000;480630920000004000000000500604002010802000400009486702340050270290040000000263194;200048350895231704030005028102000895070800410000012673620080040000000000000000000;095020300020370956000059200289137460007090830000500792000000009900003000000905003;000002361102030004030000009000925683985003042326148007200007038003200000000000000;390007485274000691005049732000900000050010379139700540500070900000000000000800007;450000300700030000300000000045300006236489517097050000574003800910000705628500000;360019807814000060900860100591000408640185000700940516100090030200000000400000000;004703100030201000091000203003020000057340820002000030015962300009835000300000592;800003005005000800200000000153000284020481653684325791098000170470100000000000000;000162000523897610000504000000305900350009000009001053002450100005913008000270090;060000197719200534354197020480000063000000900190800400000040000040002009921000040;471628090050173486386040172000000000560004700040000009000200000020436907000090000;000080000310460700806030040104008590758946300902050000600805100001000050503014000;379814005000023109010069003008000392920300000630092001583200910000900000090000000;800007063000000085000903014000000429000170856000002370004720138000400692020000547;000000000000001000009734000090473016300906207000000943900140375073569000050307069;000000100000560308000803940000000090000300000762005834800032609693408200027600483;103002000940015623005380000600030000800000000504091030009003072050178390310409000;200006945700200681800000732928000564000900327374002000007000200002000400000020076;000540008000090007000010063050000079020001030000009000592674381006125794471900000;105003094704000030239000817951074020072001040043009070300000450020000080400000060;000040001000900008600000009000060720400200390000000180570491862249687513000000947;000630000000000060060000830600000000007396184000000600000761008746859312981003756;000007020000050001040810670000004756469578210000001894304009560590000100000005900;981000004346800002000003000003070000000030000008006005017000003259301087634987251;050013000020490035030000000042000708079000300080000502705300020498625173203000050;000861000136000000008003010579402001613009040284106950361008000802000000090010000;000030748183504090000208513056000030000000005000650007000007050000300004642815379;830004000714080000650070400201807003305400700900352084020048070490000060100000040;007108000003705018108903000735000000086030000019000800062000700001070080874302165;000300060000670020100920430000800006500400000000700900080500091951200084734189652;090001600001700040070400910006000000040800506730056094000000728085027061027600059;080000975091080426000900810000261500040358060000749382000000000000000050007095638;859634712034780005070905834000007506000050009500069008320040000000070000005090000;000001650000500180070684239349068502010209843000347916000000701000000000000000300;290000173548003692000900854300000080000009520920001436009000260000000040452000008;010594000090173400000806019020081090769000001080069000800947100900610700100000900;090000420060000530830050016000714093910325074000060152000080205600100080000500001;700006051000005340450010276000307814841692735375000609000000000000000097500000000;000500000000009000000000000000001800613008000000290160000325981932817546158046237;350600800700300000100405397643000000981030000275100000010803000030000000807251436;000270000502000470000000210613500780005300000000700500050927800020168057007453120;060700539000005814400938200247056391008300000035009080080690000000080000006003900;000000264600004070000062010010000790000000020000200040000453987000871652875029431;000000865200857030050690247000002080400706050000009720000015008000068500030974012;003029006007306051046001300008000000004000000620107090359614782871000000402008000;107000050384156927000000810000060089693200745008000061000000000000605000036740098;406050000050030680000000150500400030020503406600000500395000271000379865060215000;034090800060000000090360100500080070600000030900000080000436705450827000376915248;674000000015032700023700000002000600000260017400350008500003090000920840249180370;087006000104030000053070046735080401600000300400003027572000000819020604346000000;569000300432070800718300000076000000041000060020000000257008134190007682680000900;000043089098020075000009010000370961903000752000095834000000107004910028120000000;000830170800500000003000685096700042400000800000493001030000920000900050982357416;301658400457291386008374000080030200000080035030100800800000900000003708003800000;978002534134000672562300189010050000600020000000003800020000705000000200000201493;400000009000009008090847005000938004008400000049071380874603050900200760000095840;000030062020050070069240030000093600000064000006502003900020300602300000135479286;000150030000070000030864700060731500308526000157498263000040300003017000900080000;402900180981000000506180004003890000800071009009000800320600000600000000147259638;380901060010200900900078341092007400100003000073109050209000137031790000000300000;600400571847510003020397648306000000200675834084000060002000000000000000000003416;072000968008009034039000002847031256251060309003000081700000803300000005000000007;001000000002700000090610480650037100148926030237105006024300000076050000013200000;008900310032100000941600700800010000100070080360859001010000560006791834080060000;000700584100000367000008129000020401401005972000071806300107098010000743000004000;030000020785291060062000070000000000308024607000000000800005932000032008253918746;103500000000003008000007000327001845041708000809300176510000000430100000792835001;976832400500691387318005692000000000000000800090000000207050108000208904489000000;300000060200005470800000150900650847400300920527800306600004792100000084702000000;000030009070208005030100024785413962000680053003950008010000006400001007020000091;000067000000001060036094008004100000000000000001000050008459732497623005523710496;500000090940000000000900000296001538834200671700368942309800456000000029000000010;500607000206053008000020560103095476900136052652700000060000000000000600005060937;032978000906000732070236000090000040020090000040060000360005000810609003259387400;200008000860000200000006000023879140005401000040002000392080010418290003506143800;139004702000000300000000800010000200040000570090200603580000127967521438021700900;700028600200706500600040002100600000307250080502870060400000020925080106800962000;008607143300498702045020000050000000030080000870034000507349000124065930900000000;008000204025849630400002508306000005004008003207000006030106000040000060001284359;050040000000050900000010040048967312792138060361524008000400050100305000005600000;010900000000100000439602070080390062960020010325716040800209050503401280000000000;061098004032406180080200000010860000090120807258009461109600300800500000000900000;026007008000648200080192060000004006601003000000006000253489600060001000009265384;000530000040891000350004089000356000000048305435009000803075004109482000504003000;000400530634958000000730060210003000000000000000000000009315006823649157165287000;006100800287004009000208046165927384823541967070800251000000000000000000000000000;237986154005400602609521003000000210020000500000205030590800007068050001000000005;607000003390406001080007062859763004163524897004090030000000000000000000900040308;000803000839076500000095083000700350052900008000500000000450000090620800174389265;370968240060725031000010076710080324000071589000030017200190408000000000000000000;940010076030700040870504910604957000700483600583126794000000000000000000007600000;065008000170052896280000000850237049630000128020186750006000080000000060000000074;508000000006804350304250608030000005000005006650007003001500060245716830063000500;167000000843726005002041080009063008284197000631850000400009200000000000025600000;863047000020063040471059000008600004700008009002000080617020000059086071084070000;000030279013024856020570143004000901200841000100000008571483692000000000000000000;005000306000200040000300200536010784000760000900835162050680420000520600000003875;973425006524681397168739452000910000200300001010850000001040000000000000000000000;780030002002000000315020067824003196139000574657400823070000600000600000060000000;000040000001003004046000008179458600384062000562030487603005740400300000800004000;721000394050413020843297156570900030364072080192300400000000000000000000000000000;600057100105000078037186000000078060700469000000013097350600780800701000070805000;720050094000640020030720060060037058000081000070065010603002000900006002287504030;090070562060000007500060004050126708000598001800347000000700000300200070020619483;500090000700000000900002400000010000100003000357269841493806007015374690070901004;460000005910856000000004600130000520500000700609502134046798051891605000000000000;190000040004000190302000075008000010401300050030000020210000080003281060846759231;000008090542916378897000160020185640080624050654000821400000000000000000000000005;104000090209060104865941700000090300000500040490700000583004010700109500910005400;000000008040853000008000000000472001100608900000915002000587000000396504965241783;907000050241500006600000020000000002000005079300000000824957060516040000793168245;000010000203087060006320749031240000050860072028753000302008000500134020000000003;570000049890000010002009050420100980600090021900020074700000092200900038009200765;000806035005090804048153609003619408000408067486507000000074000004001000000005000;090000005510000903000509006005000000000700500009005000020001854958400167641857392;000000020000020090092056000075000000020600000900200000261874539739512486850903000;000000609068000703090860401000000070000000008000200906500000134839041260610372895;000904050020801300000602000050396000300127500000548000091065000500089060000413795;000005200000200010263819475030401628080020790020080350908002107070100000000000002;010000064060000352005003019030000607602307081701090035100008006400009573000000108;009000000007300098000092004900000000000019602600200907000941300541623809096578001;068070000319000600257631000001700006093000050002500010170020000830000000924357860;023008910000204803480030200940000100178042000230009000304820000802000041000400028;000070060010400070000000394000006009004007602000200003040738021532619847000500936;000600003300200000050300000503480090940100578000590634194723865630000000005060000;982613754005020090007598003801930040093000070064150030009005367000000000000000000;000010004000508060000604008350291607020857000000436050030142096960785000000060000;000000070000000345000000106006849537000715600758236491030620000600000000001590260;008020007001307000600180503005900700700500060890000435100000274504000391200000856;000000182860020000215000000002000491008040025641052378020010030000209014180000200;200000803900000000630002001302984600060000000000000000593240106847165932106009400;210003000548000300609200700970840000180300009360002007753020000820650000496030000;000065000000073000094281750900754008705892064040316597020000000409620000000000000;156200000000594617497186000509400100004900000000600049305860000008741000000350000;980324100100090008000008900000809010098000005000060830807940520009000080340582790;871006432495000876236847519900073650003200008004600000300760000000000000000000000;576002040090360000820710590760400000009071000018500400000600002602100000937200604;500200004000000201000400000685300002200507930397062405000000600073600549968750000;300007906000100005000000008000600701000708430705014602009435007500201863000870590;100000200370006400009030007591000000000015009000900000816324975253789000947001000;000000006000000003460713059006005984000000167000000530600000090287691345903007620;069400000002500000004200000290704030150309000300002000001920306675831040923640000;080300000002080000010062000000670000000000006000200004296814573347526001158739002;304000000271486305509000070706001940900040500408069000007004000140608729000070000;600000000500200000108000000800541000410672008260398104956000000781400069324900000;010000600600000800400000000000400000060902405094053000946531728000829546580764000;438000009000837041571000283700003004000000007304005096007029615000004908000000402;031000507008000102007910600300006409094300800000491300009050208006207900023009700;700150608091080207000200103000800500900605001050002870070020360000000080005768914;009051206040697000000842000900780402020130908000020600002070001000560720700210004;000976510060050800501843260000000005005000000040500000819435672000629000000718300;086731000700564801041029000679012080150087926008695007000000000005900000000000000;000268571862001349000000806000000250000000630084000900000000065008006792570092083;700800000800600002600300089070008000208007000040000008180000547400080913593714826;400006070007001040000007000000604000070085000510002069050260000042713658136458090;000315086060792543000684010007000000000000670600007004000470060000000430486950127;306270100204080003080300027500420000802793000000000702000000070000037000748912365;000071429201094000947825631790008003183260547000037000009002000000000000000000004;000610908006498302980720000341967825008534000605080734800050000000000000000000000;749001806020469000630807000050006000900008002000005060000580600500670014376194000;931560020042003000050200930016789300370006000000300070100630000025001003463070000;004000098000040076280000451009387105000154903135296784000020800000000600000000500;010643287002800641864020000650214000240368000183975426000000000000000000000000000;026040150500000000000526800002001405005804021004050007000000506957463218060005000;130700060060200080000160090050010040001006900003000050816000020347600519000471836;260803001000000082080210076845300000670000804190468005430000007056702040700000000;000000764060040000471806002000671480040930020010204000104500070007460210680000040;000340600941576283306200470000000900709000800000000320000020506500987132000000708;100700004000800309900320007200103968000682001816500200028400795000900002000200006;000012860100007050000305401000004000000103580000006000006008005509631248801509673;761090003384000075050073000097000000000309007430000192603008000015642730002030000;000060010000010026001030000008300001006000307003000002005100238732584169189623000;000938604904000000063540000427896531600453728530000006100080000340700000000000000;829004761510080040400021050702800106608000400100000020980000070300000080200008314;063249857029801004000630912000580100600003000001000000016300508050068001070000006;940002650600003900000695000000009400009000065004006009895034716400560390700910000;000300000000000000000000503907000800000978401000500970090100287258746319731892600;800006521000200978027008000060390285008020760002680310280000107000802000000000802;";
const easyPuzzlesString = "470305000500002043030004800324008007000457238785236914257841396900573482843629000;809145760040090000000030094014209000008514609950803421495387216183406957060951348;647135928190478653008629147004006301080714269061302504400200806806040000009060435;300764912742319006691852734003490621406120300129000470037241060010070203260000107;050006370030007500078035400785342610410009853396158247021004735563001984047503100;740160903100974002860235107200391006984756320010840079600480215528613794000000038;000903027230006409905002003300569148500438972489721006794285001000394785853607004;630519027914807653020634189250060700400781295090245061509376810000000006000192574;837624910020759034954138726003412000002870001000390200300200159410903072270561483;409250816506814790100690000094126357765349128312578009040900000000400900953761204;907054632826730014500120098680072301700608200092305867200460185461587903058200000;789005132621087005345129000918673254472591368563842000006700000890216503000900000;062085104008400205005207608607521043520640017001070526000750461054100789176894352;852461009790283000100957008321576984489132000675894003208009500940620801500008092;713092045809547020000308706000854060000761050650020400176280534382475010594136278;750102008000804175481657392000020007070080003000760901597348216314276859008519734;341985762000241938892376541425819376010453009983762000234098600000007000070004000;600541000940308061010926745200407000500602000086090400039864572768253914452719386;800056000300080005705030008450628197170349850902075634604892571097513486518060300;210753800508400030309006500842105673106370040937640005601084357493507000705231469;219800060687000325305027918964572831021386000038491206852000673173268000000000082;000380210081427030203090804602013407000042100010970520126730958749050362835269741;003594768000627103607831205070100304000300607030702809080976532300218476762453081;007000030039000070200307004058431627003782095072569003005023741724815369391674258;481300296263900175597010843356001729749500381128793654910000030600000010800100062;603450900025693800490712356176924538034580019089361004840036095060005003050809060;306080197124397865709500324010623749692708531403900286901870050060100070007000018;002931480193468527860700009320547061407089053680013794546000908931800670200000305;502030000006050000701690050628915300395040002407326985863070500254189736179563428;067304008402708000908500740784935010006472839329060475690057104241080057875140020;637589400598241000241637800780300106316802000904176083809763000460918300000405968;800007300650089270790002580435278090279000438068934725500803000300021957912756843;064021000002090014195043027089135762216070390003062481008214070627359148041080200;061003000034007500092005300173268005685394271209751638407006029916872453320540000;210537408786004052004286790100002040845300106300401087070140239423790015051623870;010634759796851234453927681160382047040795006000416000600208000000100068981063072;000973020900246000002851090009532684563184279000769301000318962001697548896425000;000659374000024000060017020549183762010276495020495003000532041030761250152948637;007001009319000005602000301865000120234816590791005860458763912973182456126000038;681027400030045612542630798300086900006093070198574320000318204060059187814000539;278041935000592870050070402430805290816924753925736084560000007790003008381457000;734189256612573489598462173080007690920806700467951832000090007009000001006010908;804903270007264508002807004278149653043576802005320000730485020481092005520031480;041500020957023408082004005560007042034089650128465930815046273090000584473852100;351768294209341685864090371043000028000009037000003016732856149010904752495000800;819200367600009142234671850521007698407006200386102400008920736963708504700003900;700120438140850609090764521654300290800047056217596000003400960480032015921070384;902004000006038024304902080805029000293005800107083592031896257529347610608251439;351947286678000940429000070712380060863004109594000738107090650006000012245136897;060041350030006090040903610075324901394167805020089034417635200003412506652708103;070508002090721846824639157007084961409105700000902584932006005000097238048253609;904703012315620800200810504759008123042135008001072465103500000590301286468297050;000024903090060704040095062389512476060987531000603029030278695050439210900156348;086532090090641038010987620900854060064019080851076940070408010008105470149723856;805301006219576384376004500900013000700609140401007000184935627597162438600748900;562417938819000040730009610925148376170000854000070291358000127247000569090700483;031697085469008127857012300682741009514923768700865210300106942100200000020004001;090050260756321489000964570249573816315486927687192354060000195070000600000600700;183975246796214030245080070007000000000800307019057020972168453001042789450739162;060538901153947268000162305006203084000006030000015620621754893000689400984321756;610802395423095861005600027709008040000470080846100752398050000264380509571964238;010600420246810350900452186381265004762000010495178602150086003630520048820000561;876594213000387600350162879160403702497820300532070080703605928681000537900000100;397642185010758900800913070200830791908170000170295804000089017081467329709021008;008562473026309185005801090004136059001954000059287041002703568003425917507608004;697235800124687359385149762069010000008000600001060000812006900003491286946823175;580310649714596080690080157009701820125863704070900060806109000241075938900038016;837549000214760800690218347972681034481325976356097218500072080008030000000850000;154680920608409107730215648413926800970853461506701092200008000390074286800002000;023000479690204015540900002450092703039007050070000090782359146960721538315486927;956347100231958647840261359794500860318674000562809704000080900000090080689100470;497816325326457009851239000600170002100920000902365001268541000739602000514793200;024071095070000042953284671430000008060837904080040030345728169010500423296413587;675948120108500067302176580283491750006700800007680000700054208520867300830219675;245908371986037052017250896861493520002681934093570168000800000030740200020310700;430021007890376420720845000569134782384267519217080346178603004042708000000002000;010060403065904200048200090104376829936028007802500364687040935591683742423700000;671004930280170004594086721709010086802007015160438290320741809917800040458000170;257938000819602573043571298590080734784053900300794000930807000178405309400309007;680500734010820569095000812968734125537160498241985070059000200126358000070200050;003621985000397062926548317000039246380476501694215073030184609000900730000703100;600300547835497162740506839000105073057203900003709005000074358300051724574832091;000295467900786231762431958000008573370004182500372694000027349097003825000000716;900138570385762149070500038030857090008300050597426810863905020700283965259600300;105094000204030005300050004718020400549368712632471598953612847821700659400080001;712905408598200007304710095603170984241089003900354000836521749105490800409800050;000025700052736409070098500000254837280917054745683001401002365000549002527361948;690004000710060004342051600587213946923476000461598723276185439839040000154000000;968147352435829671172356894703984065854261739090735048009502000000000020000000000;016384509304509000005100034100450000540690018608031945457810692060745080831962457;100900408794058210000341957089106745046507109017400806931864570000015304470200681;000200000400306250025800360050460893803921506967583410630100708712648035509732641;617458392409326107320000604200045901500000426094632875730069548842510060000004013;720100000004060012010208007065301004340896125891524763632050001078612539159483200;206080074503000086807001352431806729985000643762439518128960430674000090359000060;005000043003000091007000065589624137271000654364000928732000416156247389498103572;009028750208075091005010283007102405024067139001030827000243918183796542002800376;845273006267891354000004020653149278912086035070532060704910603500000702086027500;900514276071896050045000089750082931832941060169050842097165028028000610016008090;007060809698032004145798623960853147451070238873000965004000001080010000519247386;309610000108970000672380159286009500591008000734056000963001475417563982825497300;215000000934700500687051420543800000762510348108430000821695734456173002379248000;408006020090740568617820004781250000500600412200900005143567289976480351805139740;652094108079816003003275946728063405004080302391400067000000520235641709947520030;200437508547028300038905274783002400005874023420093080850046030074381052310059840;023070968000000342400300715059043820302059074804000500981236457647915283205487090;000390080830251964069840350071964528090508040084172603023780016010009800408613279;834065072260073408019208000000706234576032180023819005007694000348521097692380001;761329584342658719090147020000034000000015800000286000259473168000592437400861295;000569312629410758051287604413605280060001030097004165046000873070008046538706920;100758043070320816408169257307086120600041300001203680800617430204830701713090068;007129000892546000106038294910052706608490002024367809400213987730084025280075400;597400680640950370003000594905687413400390726706142958374019860060570009159000007;956274130010000056070561942090612087760000010021700069180409673639187020047306891;200768390080024006960135284128547639006203000000601000000356800835412067612879453;000005790002087135507013420289070603700360982016800074841736209925048360073059840;015427309042053001730186542408702053126539870500841926050204600004000007260308405;000005302532814769009030504000329478248071693390486125003000841820103957000008236;785090003423715869060843275016000937094000521072109684648500092037028056250000008;050040002270903604000000753800090576649875321507060809700080195084539267965217438;000854627284176953700923418509281046400709085000340092000038070000017030347592861;900560804000800000008200010219385647345600008867420000524738961796142583183956002;805296374439817520060400801100600900290701000580920017341078209057362148628049000;000030190174259386030681470785912643390546028246073901000090014000160037010020569;792056831605030492304000050128975364547623189936814275261300540070500000050000000;187300256004750801600821037823900674406037085705640309940080063372069000008073942;592010000301569000608273951283056190704001862910000005469185003825397000037602589;970005610530010970010700058183400567795800241642571839369007405807050190451900700;746128539591000862283956714000089406064502108000614305000000057000800043437295681;048000035963581724720063108080645271456000300217308406630050847090004003004836912;026873450705946002000215076470002500609457210500089047867591324090624005200738060;070485163036029080108376092001037248327814056894652017700061030005790020003048070;204608509008532400000491002302780650000126308086350207009863120823015700561247983;847000062591080473632000018006050039050090026918060754164529387279831600305000291;243567189080421753751938040000746328478352961362819475000090800800070500000080000;300000000207000006900000300724000198085912473093007652572136849816294735439578261;000704600056821904040605800400972300537468200209513740623149500175386400894057100;760009154105730609894156237542971063678345021319628405080000042200400000000802006;790530026821967543003240090007009204239406700408702309942075638370800000005693472;580267900032014065716935840079403000351000420420701396007540130145390078203070054;516297403090341007374586000751634090283759146009012735128960370930008000000103000;810300745053240961649000832491732580567000123028051079175003604280000307930000208;096743020214006739030192456000360507000000263365027000453010670000674315671235984;008071032003000187172008064857000621200085349934126758725813496380460205000000803;000500423341297586625438791280000350950000210134752869403025678002000945000000132;257910006031847009984065137816394070049700610072601040100070800795100064400536791;980620300625400789430809200209500803704382905358190400192700638503268190806900500;002100490109374250405629100670900004540260709020407005850092341290800567317546982;028176509310950247000020000174683952903207400680500071861432700030801624240765003;731856042025470086468002705512308670840765200670200850180020007357680420290007008;060489705917532846000617293070905100020163470000708500040891350000376924700254681;000019000172835496009062000601908040905046700000051960268594137593187624714623009;615783249870421000234650718100960300963274851000310000006802100321097486708106000;200000045034650820010004060000003452340005608052468703675319284891742536423586070;073002106020006305865301027539008001017403508084105003106804752342007819758219600;935814762264573981781962345046000097500400018000000034008020450010045820452600173;438621957295378641167050283050832714702000009304007020071280005523700008840000072;000002407002000069700000002693427851275681394400359276926135748134876905007000013;400030008080090304369408521694012753030946182108753009216387005843009017900100036;405789123020006748783402569070930086600870035008620017006598070807243691000167050;050028006026000058874605902008592003095083261732164589040006805569841327080050604;978361524231004869546892173189003256352600007764020308003207080005006702027000000;826000005459682371137549628592006800713894562684253010205008100001005080068000050;600380050430975810859620743005730460726140305043560070390056120060013500018297630;500000007207500004891476500415827369682305471973164200128753906750040100300081700;837400912160982743029731658258000467371600289694827135040070020780000000010200070;700564210496701500021098476145000083089456107670100905267805004004000700913647852;700650089904280075058090260017509032032068951805102746070800014006300590541976328;000601389980300146301984725000410007718592634000030001806240500500163408134857962;908700056104500789507000043016800597782005401495000802043200605251600974679451328;730020854508000032400835017085317409007480305043050781354298176070563248000000593;390412800802957003507083200760521394401890520050704000185240006620378051073065480;428000709175948263963572040050290030000430500034865010587020090342059000619784325;513896274008037156607015389006050700004760500750320608005602931169580027372040005;490062570765000000382075490613289754249530861807416000504621980070008040028700605;718609543650004287002057916281005360507008120943261058000006002006002005824593671;745923186138670249629814070570098000280156000061347852006039420307402000402001000;806297315500481960109000040384176529712540638695820174400908050900702000008004790;726348150083102006014090832165983427247561398090000605072009500059000200631005904;000840306400253819350690400004918503603072180085364290549006030800739605030485921;053700820290083541086125739020307618071008294000200075000900163719036052002451987;962153487735842961814967532090000000601004700000000000586379214143625870079400050;100070005500100000900500710475361090800957100691428537259746381700213459314895070;102000000300172500800600012709036841613784925548921637400000259901250400285469170;407902103962010008100087620014609307009050060008034590006875914741206835895341270;392070184568314729704892000000000012241000000036020040485139276123007498679248001;700428615681753294452169370000541726165297483274006159010600802040002000020000000;200010004005230019600040207523684791048093502960025348850471903390802076002360485;700513249024708000390420807200304500540000020930052084853907102619235478472861900;070109520510000079982547631601700090208900017740831250027090100165278943093015702;930258010600403059000601030152736948096845321483912070805129063200360080360580000;419256738065310924032900516021000307970421685048673090386000070150030060290060053;402905368963284517500600200000430605004560000605098002006749851159826000847351926;050002800029001500680075429043008197918734260067509384072846053430007008890103742;600008000103409867800006000362594781408167050715832006947681000236945178581003600;003280194000437280284910307002001873008002900000098420145869732329004618800123549;038490000725168493094230000340006928802904300960382004416009030589623107273041009;800240000035798621270130840002459163901673000603821097568910000327584916100360000;416739852259648000730512096943200168582164900167893524670920380005000000001000000;458967213369412587127008694530680972072090840890270360005106000003020156016000000;";

let puzzles = hardPuzzlesString.split(";");
let puzzle = null;

let undoStack = [];
let redoStack = [];

const noSleep = new NoSleep();

let wakeLockEnabled = false;
const toggleEl = $("#toggle");
toggleEl[0].addEventListener('click', function() {
    if (!wakeLockEnabled) {
        noSleep.enable(); // keep the screen on!
        wakeLockEnabled = true;
        toggleEl.removeClass("unselected");
    } else {
        noSleep.disable(); // let the screen turn off.
        wakeLockEnabled = false;
        toggleEl.addClass("unselected");
    }
}, false);

function level(easy) {
    if (easy) {
        $("#easy").removeClass("unselected");
        $("#hard").addClass("unselected");
        puzzles = easyPuzzlesString.split(";");
    } else {
        $("#hard").removeClass("unselected");
        $("#easy").addClass("unselected");
        puzzles = hardPuzzlesString.split(";");
    }

    newGame();
}

function mode(v) {
    switch (v) {
        case 1:
            $('#numberbuttons').show();
            $('#markbuttons').hide();
            $('#centerbuttons').hide();
            $('#colorbuttons').hide();
            $('#numbers').removeClass("unselected");
            $('#mark').addClass("unselected");
            $('#center').addClass("unselected");
            $('#color').addClass("unselected");
            break;
        case 2:
            $('#numberbuttons').hide();
            $('#markbuttons').show();
            $('#centerbuttons').hide();
            $('#colorbuttons').hide();
            $('#numbers').addClass("unselected");
            $('#mark').removeClass("unselected");
            $('#center').addClass("unselected");
            $('#color').addClass("unselected");
            break;
        case 3:
            $('#numberbuttons').hide();
            $('#markbuttons').hide();
            $('#centerbuttons').show();
            $('#colorbuttons').hide();
            $('#numbers').addClass("unselected");
            $('#mark').addClass("unselected");
            $('#center').removeClass("unselected");
            $('#color').addClass("unselected");
            break;
        case 4:
            $('#colorbuttons').show();
            $('#numberbuttons').hide();
            $('#markbuttons').hide();
            $('#centerbuttons').hide();
            $('#numbers').addClass("unselected");
            $('#mark').addClass("unselected");
            $('#center').addClass("unselected");
            $('#color').removeClass("unselected");
    }
}

function newGame() {
    let randomPuzzleIndex = Math.floor(Math.random() * (puzzles.length + 1));
    puzzle = puzzles[randomPuzzleIndex];
    resetGame();
}

function resetGame() {
    let counter = 0;
    $("#board").empty();
    for (let r=1; r < 10; r++) {
        const row = document.createElement("div");
        $(row).attr("class", "row R" + r);
        for (let c=1; c < 10; c++) {
            const cell = document.createElement("div");
            $(cell).attr("id", "C" + r + c);
            $(cell).attr("class", "cell C" + c);
            const div = document.createElement("div");
            $(div).addClass("number");
            $(cell).append(div);
            if (puzzle[counter] != "0") {
                $(div).append(puzzle[counter]);
                $(cell).addClass("fix");
            }
            const divM = document.createElement("div");
            $(divM).addClass("m");
            $(cell).append(divM);
            const divC = document.createElement("div");
            $(divC).addClass("c");
            $(cell).append(divC);
            const divB = document.createElement("div");
            $(divB).addClass("border");
            $(cell).append(divB);
            counter++;
            //$(cell).attr("onclick", "cellClicked(" + r + "," + c +")");
            $(row).append(cell);
            
            // $(cell).click(function(e) {
            //     cellClicked(e, r, c);
            // });
        }
        $("#board").append(row);
    }
    initCellClickHandlers()
    undoStack = [];
    redoStack = [];
}

function initCellClickHandlers() {
    for (let r=1; r < 10; r++) {
        for (let c=1; c < 10; c++) {
            const cell = $("#board").find('.R' + r).find(".C" + c);
            $(cell).click(function(e) {
                cellClicked(e, r, c);
            });
        }
    }
}

function check() {
    $(".error").removeClass("error");

    let counter = 0;

    //rows
    for (let r = 1; r < 10; r++) {
        const numbers = [];
        for (let c = 1; c < 10; c++) {
            if (!checkCell(numbers, r, c)) {
                return;
            }
            if (!cellIsNull(r,c)) {
                counter++;    
            };
        }
    }

    //columns
    for (let c = 1; c < 10; c++) {
        const numbers = [];
        for (let r = 1; r < 10; r++) {
            if (!checkCell(numbers, r, c)) {
                return;
            }          
        }
    }

    //sections
    for (let sr = 0; sr < 3; sr++) {
        for (let sc = 0; sc < 3; sc++) {
            const numbers = [];
            for (let r = sr * 3 + 1; r < sr * 3 + 4; r++) {
                for (let c = sc * 3 + 1; c < sc * 3 + 4; c++) {
                    if (!checkCell(numbers, r, c)) {
                        return;
                    }
                }
            }
        }
    }

    if (counter == 81) {
        showInfo("Sudoku gelÃ¶st!");
        return;
    }

    showInfo("Keine Fehler gefunden")
}

function cellIsNull(r, c) {
    const cell = $("#board").find('.R' + r).find(".C" + c);
    const value = $(cell).find(".number").html();
    return value.length < 1;
}

function checkCell(numbers, r, c) {
    const cell = $("#board").find('.R' + r).find(".C" + c);
    const value = $(cell).find(".number").html();
    if (value.length > 0) {
        if (numbers.indexOf(value) >= 0) {
            $("#board").find('.R' + r).find(".C" + c).removeClass("selected").addClass("error");
            showInfo("Doppelte Zahl " + value + " an Stelle " + r + " / " + c);
            return false;
        }
        numbers.push(value);
    }
    return true;
}

function addUndoEntry(fromRedo) {
    undoStack.push(getState());
    $("#undobutton").removeClass("disabled");
    if (!fromRedo) {

    }
}

function addRedoEntry() {
    redoStack.push(getState());
    $("#redobutton").removeClass("disabled");
}

function getState() {
    return $("#board").html();
}

function setState(s) {
    $("#board").html(s);
    initCellClickHandlers();
}

function undo() {
    if (undoStack.length > 0) {
        addRedoEntry();
        setState(undoStack.pop());
    }
    if (undoStack.length == 0) {
        $("#undobutton").addClass("disabled");
    }
}

function redo() {
    if (redoStack.length > 0) {
        addUndoEntry(true);
        setState(redoStack.pop());
    }
    if (redoStack.length == 0) {
        $("#redobutton").addClass("disabled");
    }
}

function buttonClicked(number) {
    if (!$('#highlight').hasClass('unselected')) {
        highlight(number);
        return;
    }

    if ($(".cell.selected").not(".fix").length == 0) {
        return;
    }
    
    addUndoEntry(false);

    $(".cell.selected").not(".fix").each(function(){
        $(this).find(".number").html(number == 0 ? "" : number);
        $(this).find(".m").html("");
        $(this).find(".c").html("");
    });
}

function markButtonClicked(number) {  
    if (!$('#highlight').hasClass('unselected')) {
        highlight(number);
        return;
    }

    if (number == 0) {
        $(".markbutton.selected").removeClass("selected");
    } else {
        $("#markbutton" + number).toggleClass("selected");
    }

    if ($(".cell.selected").length == 0) {
        return;
    }

    addUndoEntry(false);

    let marks = "";

    for (let i = 1; i < 10; i++) {
        if ($("#markbutton" + i).hasClass("selected")) {
            marks += i;
        }
    }

    $(".cell.selected").not(".fix").find(".m").html(marks);
}

function centerButtonClicked(number) {   
    if (!$('#highlight').hasClass('unselected')) {
        highlight(number);
        return;
    }

    if (number == 0) {
        $(".centerbutton.selected").removeClass("selected");
    } else {
        $("#centerbutton" + number).toggleClass("selected");
    }

    if ($(".cell.selected").length == 0) {
        return;
    }

    addUndoEntry(false);

    let marks = "";

    for (let i = 1; i < 10; i++) {
        if ($("#centerbutton" + i).hasClass("selected")) {
            marks += i;
        }
    }

    $(".cell.selected").not(".fix").find(".c").html("<span>" + marks + "</span>");
}

function colorButtonClicked(cssClass) {
    if ($(".cell.selected").length == 0) {
        return;
    }

    addUndoEntry(false);
    $(".cell.selected").removeClass("red green blue");
    $(".cell.selected").addClass(cssClass);
}

function cellClicked(e, r, c) {
    const cell = $('.R' + r).find(".C" + c);
    const multiple = e.ctrlKey || !$("#multiple").hasClass("unselected");

    if ($(cell).hasClass("selected")) {
        $(cell).removeClass("selected");

        if (!multiple) {
            $(".cell.selected").removeClass("selected");
        }  

        return;
    }

    if (!multiple) {
        $(".cell.selected").removeClass("selected");
    }    

    if (!$(cell).hasClass("fix")) {
        $(cell).addClass("selected");
        const marks = $(cell).find(".m").html();
        $(".markbutton").removeClass("selected");
        for (let i = 1; i < 10; i++) {
            if (marks.indexOf(i.toString()) > -1) {
                $("#markbutton" + i).addClass("selected");
            }
        }

        const center = $(cell).find(".c").html();
        $(".centerbutton").removeClass("selected");
        for (let i = 1; i < 10; i++) {
            if (center.indexOf(i.toString()) > -1) {
                $("#centerbutton" + i).addClass("selected");
            }
        }
    }    
}

function highlight(number) {
    $('.highlighted').removeClass("highlighted");

    $('.cell').each(function(){
        if ($(this).find(".number").text().indexOf(number.toString()) > -1) {
            $(this).addClass("highlighted");
        }
    });
}

function showInfo(text) {
    $('#infotext').text(text);
    $('#infomessage').show();
}

newGame();

function numberKeyClicked(number) {
    if ($('#center').hasClass("unselected") && $('#mark').hasClass("unselected") && $('#color').hasClass("unselected")) {
        buttonClicked(number);
    }
    if ($('#numbers').hasClass("unselected") && $('#mark').hasClass("unselected") && $('#color').hasClass("unselected")) {
        centerButtonClicked(number);
    }
    if ($('#numbers').hasClass("unselected") && $('#center').hasClass("unselected") && $('#color').hasClass("unselected")) {
        markButtonClicked(number);
    }
}

function move(direction)
{
    if ($(".cell.selected").length != 1) {
        return;
    }

    const cell =  $(".cell.selected").first();

    const r = $(cell).closest(".row").index();
    const c = $(cell).index();

    if (direction == 1) { //up
        if (r > 0) {
            $(cell).removeClass("selected");
            $('.R' + r).find(".C" + (c + 1)).addClass("selected");
        }
    }

    if (direction == 2) { //down
        if (r < 8) {
            $(cell).removeClass("selected");
            $('.R' + (r + 2)).find(".C" + (c + 1)).addClass("selected");
        }
    }

    if (direction == 3) { //left
        if (c > 0) {
            $(cell).removeClass("selected");
            $('.R' + (r + 1)).find(".C" + (c)).addClass("selected");
        }
    }

    if (direction == 4) { //right
        if (c < 8) {
            $(cell).removeClass("selected");
            $('.R' + (r + 1)).find(".C" + (c + 2)).addClass("selected");
        }
    }
}

$(document).keyup(function(event) {
    switch (event.keyCode) {
        case 87:
            redo();
            break;
        case 82:
            undo();
            break;
        case 37:
            move(3);
            break;
        case 38:
            move(1);
            break;
        case 39:
            move(4);
            break;
        case 40:
            move(2);
            break;
        case 48:
            numberKeyClicked(0);
            break;
        case 49:
            numberKeyClicked(1);
            break;
        case 50:
            numberKeyClicked(2);
            break;
        case 51:
            numberKeyClicked(3);
            break;
        case 52:
            numberKeyClicked(4);
            break;
        case 53:
            numberKeyClicked(5);
            break;
        case 54:
            numberKeyClicked(6);
            break;
        case 55:
            numberKeyClicked(7);
            break;
        case 56:
            numberKeyClicked(8);
            break;
        case 57:
            numberKeyClicked(9);
            break;
        case 90:
            mode(1);
            break;
        case 65:
            mode(2);
            break;
        case 70:
            mode(4);
            break;
        case 73:
            mode(3);
            break;
        case 109:
            $('#multiple').toggleClass('unselected');
            break;
        case 98:
            $('#toggle').click();
            break;
        case 99:
            check();
            break;
        case 13: //ENTER
            if ($('#infomessage').is(":visible")) {
                $('#infomessage').hide(); 
            }
            break;
        default:
            //alert('Handler for .keyup() called. - ' + event.keyCode);
    }
});